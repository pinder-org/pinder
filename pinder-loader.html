
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pinder loader &#8212; PINDER 0.1.dev1+g20487ac documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=3eb10145" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Geologica:wght@100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=16cc9b0e"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pinder-loader';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://pinder-org.github.io/pinder/pinder-loader.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pinder eval" href="pinder-eval.html" />
    <link rel="prev" title="Pinder system" href="pinder-system.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.dev1+g20487ac" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/pinder.png" class="logo__image only-light" alt="PINDER 0.1.dev1+g20487ac documentation - Home"/>
    <img src="_static/pinder.png" class="logo__image only-dark pst-js-only" alt="PINDER 0.1.dev1+g20487ac documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="readme.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="source/pinder.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="example_readme.html">
    Pinder abstractions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="faq.html">
    FAQ
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="limitations.html">
    Limitations
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="changelog.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pinder-org/pinder/" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.biorxiv.org/content/10.1101/2024.07.17.603980v4" title="Article" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-file-lines fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Article</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="readme.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="source/pinder.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="example_readme.html">
    Pinder abstractions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="faq.html">
    FAQ
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="limitations.html">
    Limitations
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="changelog.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pinder-org/pinder/" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.biorxiv.org/content/10.1101/2024.07.17.603980v4" title="Article" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-file-lines fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Article</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pinder-index.html">Pinder index</a></li>
<li class="toctree-l1"><a class="reference internal" href="pinder-system.html">Pinder system</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Pinder loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="pinder-eval.html">Pinder eval</a></li>
<li class="toctree-l1"><a class="reference internal" href="superposition.html">FAQ: cropped monomer superposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="pinder-mlsb.html">MLSB PINDER Challenge</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="examples.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Pinder loader</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pinder-loader">
<h1>Pinder loader<a class="headerlink" href="#pinder-loader" title="Link to this heading">#</a></h1>
<p>The goal of this tutorial is to provide some hands-on examples of how one can leverage the <code class="docutils literal notranslate"><span class="pre">pinder</span></code> dataset in their ML workflow. Specifically, we will illustrate how you can use various utilities provided by <code class="docutils literal notranslate"><span class="pre">pinder</span></code> to write your own data pipeline.</p>
<p>While this tutorial will not go into details about how to write your own model, it will cover the basic groundwork necessary to interface with structures in pinder and the associated splits and metadata. You will of course want to implement your own featurization pipelines, data representations, etc. but the hope is that this tutorial clarifies how to access the data and make use of it in an ML framework.</p>
<p>Before proceeding with this tutorial section, you may find it helpful to review the existing tutorials available in <code class="docutils literal notranslate"><span class="pre">pinder</span></code>.</p>
<p>Specifcially, the tutorials covering:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pinder-org.github.io/pinder/pinder-index.html">pinder index</a></p></li>
<li><p><a class="reference external" href="https://pinder-org.github.io/pinder/pinder-system.html">pinder system</a></p></li>
<li><p><a class="reference external" href="https://pinder-org.github.io/pinder/superposition.html">cropped superposition</a></p></li>
</ul>
<section id="accessing-and-loading-data-for-training">
<h2>Accessing and loading data for training<a class="headerlink" href="#accessing-and-loading-data-for-training" title="Link to this heading">#</a></h2>
<p>In order to access the train and val splits for PINDER, please refer to the <a class="reference external" href="https://github.com/pinder-org/pinder/tree/main?tab=readme-ov-file#%EF%B8%8F-getting-the-dataset">pinder documentation</a></p>
<p>Once you have downloaded the pinder dataset, either via the <code class="docutils literal notranslate"><span class="pre">pinder</span></code> package or directly through <code class="docutils literal notranslate"><span class="pre">gsutil</span></code>, you will have all of the necessary files for training.</p>
<p>To get a list of those systems and their split labels, refer to the <code class="docutils literal notranslate"><span class="pre">pinder</span></code> index.</p>
<p><strong>We will start by looking at the most basic way to load items from the training and validation set: via <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> objects</strong></p>
<section id="recap-pindersystem-and-structure-classes">
<h3>Recap: PinderSystem and Structure classes<a class="headerlink" href="#recap-pindersystem-and-structure-classes" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">pinder.core</span> <span class="kn">import</span> <span class="n">get_index</span><span class="p">,</span> <span class="n">PinderSystem</span>

<span class="k">def</span> <span class="nf">get_system</span><span class="p">(</span><span class="n">system_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PinderSystem</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PinderSystem</span><span class="p">(</span><span class="n">system_id</span><span class="p">)</span>


<span class="n">index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">()</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">get_system</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">system</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:09:52,578 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PinderSystem(
entry = IndexEntry(
    (
        &#39;split&#39;,
        &#39;train&#39;,
    ),
    (
        &#39;id&#39;,
        &#39;8phr__X4_UNDEFINED--8phr__W4_UNDEFINED&#39;,
    ),
    (
        &#39;pdb_id&#39;,
        &#39;8phr&#39;,
    ),
    (
        &#39;cluster_id&#39;,
        &#39;cluster_24559_24559&#39;,
    ),
    (
        &#39;cluster_id_R&#39;,
        &#39;cluster_24559&#39;,
    ),
    (
        &#39;cluster_id_L&#39;,
        &#39;cluster_24559&#39;,
    ),
    (
        &#39;pinder_s&#39;,
        False,
    ),
    (
        &#39;pinder_xl&#39;,
        False,
    ),
    (
        &#39;pinder_af2&#39;,
        False,
    ),
    (
        &#39;uniprot_R&#39;,
        &#39;UNDEFINED&#39;,
    ),
    (
        &#39;uniprot_L&#39;,
        &#39;UNDEFINED&#39;,
    ),
    (
        &#39;holo_R_pdb&#39;,
        &#39;8phr__X4_UNDEFINED-R.pdb&#39;,
    ),
    (
        &#39;holo_L_pdb&#39;,
        &#39;8phr__W4_UNDEFINED-L.pdb&#39;,
    ),
    (
        &#39;predicted_R_pdb&#39;,
        &#39;&#39;,
    ),
    (
        &#39;predicted_L_pdb&#39;,
        &#39;&#39;,
    ),
    (
        &#39;apo_R_pdb&#39;,
        &#39;&#39;,
    ),
    (
        &#39;apo_L_pdb&#39;,
        &#39;&#39;,
    ),
    (
        &#39;apo_R_pdbs&#39;,
        &#39;&#39;,
    ),
    (
        &#39;apo_L_pdbs&#39;,
        &#39;&#39;,
    ),
    (
        &#39;holo_R&#39;,
        True,
    ),
    (
        &#39;holo_L&#39;,
        True,
    ),
    (
        &#39;predicted_R&#39;,
        False,
    ),
    (
        &#39;predicted_L&#39;,
        False,
    ),
    (
        &#39;apo_R&#39;,
        False,
    ),
    (
        &#39;apo_L&#39;,
        False,
    ),
    (
        &#39;apo_R_quality&#39;,
        &#39;&#39;,
    ),
    (
        &#39;apo_L_quality&#39;,
        &#39;&#39;,
    ),
    (
        &#39;chain1_neff&#39;,
        10.78125,
    ),
    (
        &#39;chain2_neff&#39;,
        11.1171875,
    ),
    (
        &#39;chain_R&#39;,
        &#39;X4&#39;,
    ),
    (
        &#39;chain_L&#39;,
        &#39;W4&#39;,
    ),
    (
        &#39;contains_antibody&#39;,
        False,
    ),
    (
        &#39;contains_antigen&#39;,
        False,
    ),
    (
        &#39;contains_enzyme&#39;,
        False,
    ),
)
native=Structure(
    filepath=/home/runner/.local/share/pinder/2024-02/pdbs/8phr__X4_UNDEFINED--8phr__W4_UNDEFINED.pdb,
    uniprot_map=None,
    pinder_id=&#39;8phr__X4_UNDEFINED--8phr__W4_UNDEFINED&#39;,
    atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (2556,),
    pdb_engine=&#39;fastpdb&#39;,
)
holo_receptor=Structure(
    filepath=/home/runner/.local/share/pinder/2024-02/pdbs/8phr__X4_UNDEFINED-R.pdb,
    uniprot_map=/home/runner/.local/share/pinder/2024-02/mappings/8phr__X4_UNDEFINED-R.parquet,
    pinder_id=&#39;8phr__X4_UNDEFINED-R&#39;,
    atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (1358,),
    pdb_engine=&#39;fastpdb&#39;,
)
holo_ligand=Structure(
    filepath=/home/runner/.local/share/pinder/2024-02/pdbs/8phr__W4_UNDEFINED-L.pdb,
    uniprot_map=/home/runner/.local/share/pinder/2024-02/mappings/8phr__W4_UNDEFINED-L.parquet,
    pinder_id=&#39;8phr__W4_UNDEFINED-L&#39;,
    atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (1198,),
    pdb_engine=&#39;fastpdb&#39;,
)
apo_receptor=None
apo_ligand=None
pred_receptor=None
pred_ligand=None
)
</pre></div>
</div>
</div>
</div>
<p>Notice the printed <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> object has the following properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">native</span></code> - the ground-truth dimer complex</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">holo_receptor</span></code> - the receptor chain (monomer) from the ground-truth complex</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">holo_ligand</span></code> - the ligand chain (monomer) from the ground-truth complex</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apo_receptor</span></code> - the canonical <em>apo</em> chain (monomer) paired to the receptor chain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apo_ligand</span></code> - the canonical <em>apo</em> chain (monomer) paired to the ligand chain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pred_receptor</span></code> - the AlphaFold2 predicted monomer paired to the receptor chain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pred_ligand</span></code> - the AlphaFold2 predicted monomer paired to the ligand chain</p></li>
</ul>
<p>These properties are pointers to <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects. The <code class="docutils literal notranslate"><span class="pre">Structure</span></code> object provides the most direct mode of access to structures and associated properties.</p>
<p><strong>Note: not all systems have an apo and/or predicted structure for all chains of the ground-truth dimer complex!</strong></p>
<p>As was the case in the example above, when the alternative monomers are not available, the property will have a value of <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>You can determine which systems have which alternative monomer pairings <em>a priori</em> by looking at the boolean columns in the index <code class="docutils literal notranslate"><span class="pre">apo_R</span></code> and <code class="docutils literal notranslate"><span class="pre">apo_L</span></code> for the apo receptor and ligand, and <code class="docutils literal notranslate"><span class="pre">predicted_R</span></code> and <code class="docutils literal notranslate"><span class="pre">predicted_L</span></code> for the predicted receptor and ligand, respectively.</p>
<p>For instance, we can load a different system that <em>does</em> have apo receptor and ligand as such:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">apo_system</span> <span class="o">=</span> <span class="n">get_system</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;apo_R and apo_L&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">receptor</span> <span class="o">=</span> <span class="n">apo_system</span><span class="o">.</span><span class="n">apo_receptor</span>
<span class="n">ligand</span> <span class="o">=</span> <span class="n">apo_system</span><span class="o">.</span><span class="n">apo_ligand</span> 

<span class="n">receptor</span><span class="p">,</span> <span class="n">ligand</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:09:53,554 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=15
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Structure(
     filepath=/home/runner/.local/share/pinder/2024-02/pdbs/3wdb__A1_P9WPC9.pdb,
     uniprot_map=/home/runner/.local/share/pinder/2024-02/mappings/3wdb__A1_P9WPC9.parquet,
     pinder_id=&#39;3wdb__A1_P9WPC9&#39;,
     atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (1144,),
     pdb_engine=&#39;fastpdb&#39;,
 ),
 Structure(
     filepath=/home/runner/.local/share/pinder/2024-02/pdbs/6ucr__A1_P9WPC9.pdb,
     uniprot_map=/home/runner/.local/share/pinder/2024-02/mappings/6ucr__A1_P9WPC9.parquet,
     pinder_id=&#39;6ucr__A1_P9WPC9&#39;,
     atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (1193,),
     pdb_engine=&#39;fastpdb&#39;,
 ))
</pre></div>
</div>
</div>
</div>
<p>We can now access e.g. the sequence and the coordinates of the structures via the <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">receptor</span><span class="o">.</span><span class="n">sequence</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;PLGSMFERFTDRARRVVVLAQEEARMLNHNYIGTEHILLGLIHEGEGVAAKSLESLGISLEGVRSQVEEIIGQGQQAPSGHIPFTPRAKKVLELSLREALQLGHNYIGTEHILLGLIREGEGVAAQVLVKLGAELTRVRQQVIQLLSGY&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">receptor</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-12.982, -17.271, -11.271],
       [-14.36 , -17.069, -11.749],
       [-15.261, -16.373, -10.703],
       [-15.461, -15.161, -10.801],
       [-14.842, -18.494, -12.077]], dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>We can always access the underyling biotite <a class="reference external" href="https://www.biotite-python.org/latest/apidoc/biotite.structure.AtomArray.html">AtomArray</a> via the <code class="docutils literal notranslate"><span class="pre">Structure.atom_array</span></code> property:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">receptor</span><span class="o">.</span><span class="n">atom_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([
	Atom(np.array([-12.982, -17.271, -11.271], dtype=float32), chain_id=&quot;R&quot;, res_id=2, ins_code=&quot;&quot;, res_name=&quot;PRO&quot;, hetero=False, atom_name=&quot;N&quot;, element=&quot;N&quot;, b_factor=0.0),
	Atom(np.array([-14.36 , -17.069, -11.749], dtype=float32), chain_id=&quot;R&quot;, res_id=2, ins_code=&quot;&quot;, res_name=&quot;PRO&quot;, hetero=False, atom_name=&quot;CA&quot;, element=&quot;C&quot;, b_factor=0.0),
	Atom(np.array([-15.261, -16.373, -10.703], dtype=float32), chain_id=&quot;R&quot;, res_id=2, ins_code=&quot;&quot;, res_name=&quot;PRO&quot;, hetero=False, atom_name=&quot;C&quot;, element=&quot;C&quot;, b_factor=0.0),
	Atom(np.array([-15.461, -15.161, -10.801], dtype=float32), chain_id=&quot;R&quot;, res_id=2, ins_code=&quot;&quot;, res_name=&quot;PRO&quot;, hetero=False, atom_name=&quot;O&quot;, element=&quot;O&quot;, b_factor=0.0),
	Atom(np.array([-14.842, -18.494, -12.077], dtype=float32), chain_id=&quot;R&quot;, res_id=2, ins_code=&quot;&quot;, res_name=&quot;PRO&quot;, hetero=False, atom_name=&quot;CB&quot;, element=&quot;C&quot;, b_factor=0.0)
])
</pre></div>
</div>
</div>
</div>
<p>For a more comprehensive overview of all of the <code class="docutils literal notranslate"><span class="pre">Structure</span></code> class properties, refer to the <a class="reference external" href="https://pinder-org.github.io/pinder/pinder-system.html">pinder system</a> tutorial.</p>
</section>
<section id="using-the-pinderloader-to-load-filter-and-transform-systems">
<h3>Using the PinderLoader to load, filter and transform systems<a class="headerlink" href="#using-the-pinderloader-to-load-filter-and-transform-systems" title="Link to this heading">#</a></h3>
<p>While the <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> object provides a self-contained access to structures associated with a dimer system, the <code class="docutils literal notranslate"><span class="pre">PinderLoader</span></code> provides a base abstraction for how to iterate over systems, apply optional filters and/or transforms, and return the systems as an iterator. This construct is covered in a <a class="reference external" href="https://pinder-org.github.io/pinder/pinder-loader.html">different tutorial</a> tutorial.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">PinderLoader</span></code> is <strong>not</strong> necessary to load systems in your own framework. It is simply one of the provided mechanisms if you find it useful.</p>
<p>Pinder loader brings together filters, transforms and writers to create a generic <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> iterator. It takes either a split name or a list of system IDs as input and can be used to sample alternative monomers to form dimer complexes to serve as e.g. features.</p>
</section>
<section id="loading-a-specific-split">
<h3>Loading a specific split<a class="headerlink" href="#loading-a-specific-split" title="Link to this heading">#</a></h3>
<p>Note: only the test dataset has a subset defined (<code class="docutils literal notranslate"><span class="pre">pinder_s,</span> <span class="pre">pinder_xl,</span> <span class="pre">pinder_af2</span></code>)</p>
<p>For train and val, you could just do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_loader</span> <span class="o">=</span> <span class="n">PinderLoader</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="n">val_loader</span> <span class="o">=</span> <span class="n">PinderLoader</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">pinder.core</span> <span class="kn">import</span> <span class="n">PinderLoader</span>
<span class="kn">from</span> <span class="nn">pinder.core.loader</span> <span class="kn">import</span> <span class="n">filters</span>

<span class="n">base_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterByMissingHolo</span><span class="p">(),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterSubByContacts</span><span class="p">(</span><span class="n">min_contacts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">calpha_only</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterDetachedHolo</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_components</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">sub_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterSubByAtomTypes</span><span class="p">(</span><span class="n">min_atom_types</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterByHoloOverlap</span><span class="p">(</span><span class="n">min_overlap</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterByHoloSeqIdentity</span><span class="p">(</span><span class="n">min_sequence_identity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterSubRmsds</span><span class="p">(</span><span class="n">rmsd_cutoff</span><span class="o">=</span><span class="mf">7.5</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterDetachedSub</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_components</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">PinderLoader</span><span class="p">(</span>
    <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> 
    <span class="n">subset</span><span class="o">=</span><span class="s2">&quot;pinder_af2&quot;</span><span class="p">,</span>
    <span class="n">monomer_priority</span><span class="o">=</span><span class="s2">&quot;holo&quot;</span><span class="p">,</span>
    <span class="n">base_filters</span> <span class="o">=</span> <span class="n">base_filters</span><span class="p">,</span>
    <span class="n">sub_filters</span> <span class="o">=</span> <span class="n">sub_filters</span>
<span class="p">)</span>

<span class="n">loader</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PinderLoader(split=test, monomers=holo, systems=180)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>180
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">loader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">system</span><span class="p">,</span> <span class="n">feature_complex</span><span class="p">,</span> <span class="n">target_complex</span> <span class="o">=</span> <span class="n">data</span>
<span class="nb">type</span><span class="p">(</span><span class="n">system</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">feature_complex</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">target_complex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:09:58,528 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data is a &lt;class &#39;tuple&#39;&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(pinder.core.index.system.PinderSystem,
 pinder.core.loader.structure.Structure,
 pinder.core.loader.structure.Structure)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># You can also use it as an iterator</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">loaded_ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">feature_complex</span><span class="p">,</span> <span class="n">target_complex</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">loader</span><span class="p">):</span>
    <span class="n">loaded_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/180 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1%|          | 1/180 [00:00&lt;00:50,  3.58it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:00,180 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1%|          | 2/180 [00:01&lt;02:08,  1.39it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:01,199 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2%|▏         | 3/180 [00:02&lt;02:40,  1.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:02,333 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2%|▏         | 4/180 [00:04&lt;03:46,  1.29s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:04,197 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3%|▎         | 5/180 [00:05&lt;03:52,  1.33s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:05,596 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=12
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3%|▎         | 6/180 [00:08&lt;04:52,  1.68s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:07,964 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4%|▍         | 7/180 [00:09&lt;04:24,  1.53s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:09,188 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=11
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4%|▍         | 8/180 [00:11&lt;04:57,  1.73s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5%|▌         | 9/180 [00:11&lt;03:40,  1.29s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6%|▌         | 10/180 [00:12&lt;03:03,  1.08s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:12,275 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6%|▌         | 11/180 [00:14&lt;03:55,  1.39s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7%|▋         | 12/180 [00:14&lt;02:57,  1.05s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:14,658 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7%|▋         | 13/180 [00:16&lt;03:16,  1.18s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8%|▊         | 14/180 [00:16&lt;02:31,  1.09it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:16,424 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8%|▊         | 15/180 [00:17&lt;02:51,  1.04s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:17,751 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9%|▉         | 16/180 [00:19&lt;03:13,  1.18s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:19,263 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9%|▉         | 17/180 [00:21&lt;03:46,  1.39s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:21,146 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10%|█         | 18/180 [00:22&lt;03:35,  1.33s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:22,328 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11%|█         | 19/180 [00:24&lt;03:48,  1.42s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:23,963 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=9
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11%|█         | 20/180 [00:26&lt;04:15,  1.60s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:25,978 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 12%|█▏        | 21/180 [00:27&lt;04:22,  1.65s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:27,743 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 12%|█▏        | 22/180 [00:29&lt;04:42,  1.79s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:29,850 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 13%|█▎        | 23/180 [00:31&lt;04:27,  1.70s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:31,356 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=9
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 13%|█▎        | 24/180 [00:32&lt;04:05,  1.57s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:32,625 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 14%|█▍        | 25/180 [00:33&lt;03:29,  1.35s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:33,462 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 14%|█▍        | 26/180 [00:34&lt;03:07,  1.21s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:34,357 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 15%|█▌        | 27/180 [00:35&lt;02:49,  1.11s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:35,220 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 16%|█▌        | 28/180 [00:36&lt;02:54,  1.15s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:36,466 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 16%|█▌        | 29/180 [00:37&lt;02:35,  1.03s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:37,220 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 30/180 [00:38&lt;02:20,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:37,950 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 31/180 [00:39&lt;02:41,  1.08s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 18%|█▊        | 32/180 [00:39&lt;02:09,  1.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:39,741 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 18%|█▊        | 33/180 [00:40&lt;02:09,  1.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:40,635 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|█▉        | 34/180 [00:41&lt;02:12,  1.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:41,629 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|█▉        | 35/180 [00:42&lt;02:02,  1.19it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:42,303 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 20%|██        | 36/180 [00:43&lt;02:21,  1.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:43,603 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 21%|██        | 37/180 [00:44&lt;02:31,  1.06s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:44,850 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 21%|██        | 38/180 [00:48&lt;03:57,  1.67s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 22%|██▏       | 39/180 [00:50&lt;04:08,  1.76s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 22%|██▏       | 40/180 [00:50&lt;03:13,  1.38s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:50,417 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 23%|██▎       | 41/180 [00:52&lt;03:33,  1.54s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:52,319 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 23%|██▎       | 42/180 [00:53&lt;03:19,  1.44s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:53,544 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=11
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 24%|██▍       | 43/180 [00:55&lt;03:21,  1.47s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:55,079 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 24%|██▍       | 44/180 [00:56&lt;03:30,  1.55s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:56,819 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 25%|██▌       | 45/180 [00:58&lt;03:27,  1.54s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 26%|██▌       | 46/180 [00:58&lt;02:40,  1.20s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:58,720 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 26%|██▌       | 47/180 [01:00&lt;02:40,  1.20s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:10:59,948 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 27%|██▋       | 48/180 [01:00&lt;02:25,  1.10s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:00,807 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 27%|██▋       | 49/180 [01:01&lt;02:05,  1.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:01,426 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 28%|██▊       | 50/180 [01:02&lt;01:59,  1.09it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 28%|██▊       | 51/180 [01:02&lt;01:37,  1.33it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:02,622 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 29%|██▉       | 52/180 [01:03&lt;01:49,  1.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 29%|██▉       | 53/180 [01:04&lt;01:45,  1.20it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:04,499 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 30%|███       | 54/180 [01:05&lt;01:40,  1.25it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:05,216 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 31%|███       | 55/180 [01:06&lt;01:36,  1.29it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:05,933 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 31%|███       | 56/180 [01:07&lt;02:07,  1.03s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:07,555 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 32%|███▏      | 57/180 [01:08&lt;02:04,  1.01s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:08,517 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 32%|███▏      | 58/180 [01:10&lt;02:33,  1.25s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:10,346 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 59/180 [01:11&lt;02:28,  1.23s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:11,524 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 60/180 [01:12&lt;02:14,  1.12s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:12,384 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 34%|███▍      | 61/180 [01:13&lt;01:55,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 34%|███▍      | 62/180 [01:13&lt;01:49,  1.08it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:13,821 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 35%|███▌      | 63/180 [01:14&lt;01:51,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:14,838 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 36%|███▌      | 64/180 [01:15&lt;01:50,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:15,783 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 36%|███▌      | 65/180 [01:18&lt;03:02,  1.59s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:18,871 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 37%|███▋      | 66/180 [01:20&lt;03:00,  1.58s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:20,438 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 37%|███▋      | 67/180 [01:21&lt;02:50,  1.51s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:21,756 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 38%|███▊      | 68/180 [01:22&lt;02:24,  1.29s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:22,540 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 38%|███▊      | 69/180 [01:23&lt;02:01,  1.10s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:23,193 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 39%|███▉      | 70/180 [01:24&lt;02:02,  1.11s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 39%|███▉      | 71/180 [01:25&lt;01:45,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:24,971 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 40%|████      | 72/180 [01:26&lt;01:50,  1.03s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:26,130 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 41%|████      | 73/180 [01:27&lt;01:43,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:26,973 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 41%|████      | 74/180 [01:29&lt;02:21,  1.34s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:29,167 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 42%|████▏     | 75/180 [01:30&lt;02:21,  1.35s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:30,541 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 42%|████▏     | 76/180 [01:31&lt;02:16,  1.31s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:31,775 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 43%|████▎     | 77/180 [01:32&lt;02:03,  1.20s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:32,718 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 43%|████▎     | 78/180 [01:33&lt;01:56,  1.14s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:33,721 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|████▍     | 79/180 [01:35&lt;02:08,  1.27s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:35,285 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=9
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|████▍     | 80/180 [01:37&lt;02:33,  1.54s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 45%|████▌     | 81/180 [01:38&lt;02:12,  1.34s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:38,318 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 46%|████▌     | 82/180 [01:39&lt;02:05,  1.28s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:39,467 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=6
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 46%|████▌     | 83/180 [01:40&lt;01:47,  1.11s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:40,185 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 47%|████▋     | 84/180 [01:41&lt;01:49,  1.14s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:41,376 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 47%|████▋     | 85/180 [01:42&lt;01:44,  1.10s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:42,386 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████▊     | 86/180 [01:43&lt;01:31,  1.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:43,087 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████▊     | 87/180 [01:43&lt;01:20,  1.16it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 49%|████▉     | 88/180 [01:44&lt;01:09,  1.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 49%|████▉     | 89/180 [01:44&lt;00:57,  1.57it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 90/180 [01:45&lt;00:50,  1.77it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:44,937 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 51%|█████     | 91/180 [01:45&lt;00:51,  1.72it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 51%|█████     | 92/180 [01:46&lt;00:49,  1.78it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:46,073 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████▏    | 93/180 [01:46&lt;00:53,  1.62it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:46,819 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████▏    | 94/180 [01:48&lt;01:05,  1.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:47,916 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 53%|█████▎    | 95/180 [01:48&lt;01:08,  1.25it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:48,816 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 53%|█████▎    | 96/180 [01:49&lt;01:06,  1.26it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:49,582 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 54%|█████▍    | 97/180 [01:50&lt;01:10,  1.18it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:50,550 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 54%|█████▍    | 98/180 [01:51&lt;01:07,  1.21it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:51,334 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|█████▌    | 99/180 [01:52&lt;01:08,  1.18it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 56%|█████▌    | 100/180 [01:52&lt;00:54,  1.46it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 56%|█████▌    | 101/180 [01:53&lt;00:47,  1.67it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:52,933 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|█████▋    | 102/180 [01:54&lt;00:55,  1.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:53,920 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|█████▋    | 103/180 [01:55&lt;01:01,  1.25it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:54,917 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 58%|█████▊    | 104/180 [01:55&lt;00:55,  1.36it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:55,495 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 58%|█████▊    | 105/180 [01:56&lt;01:08,  1.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:56,821 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 59%|█████▉    | 106/180 [01:58&lt;01:15,  1.02s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:58,111 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=6
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 59%|█████▉    | 107/180 [01:58&lt;01:09,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:11:58,877 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 60%|██████    | 108/180 [02:00&lt;01:22,  1.15s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:00,486 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 61%|██████    | 109/180 [02:01&lt;01:18,  1.10s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:01,492 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 61%|██████    | 110/180 [02:02&lt;01:09,  1.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 62%|██████▏   | 111/180 [02:02&lt;00:55,  1.25it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:02,572 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 62%|██████▏   | 112/180 [02:03&lt;00:59,  1.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:03,637 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|██████▎   | 113/180 [02:04&lt;01:01,  1.08it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:04,661 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|██████▎   | 114/180 [02:05&lt;01:02,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:05,683 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 64%|██████▍   | 115/180 [02:06&lt;01:02,  1.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 64%|██████▍   | 116/180 [02:07&lt;00:51,  1.23it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:07,124 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 65%|██████▌   | 117/180 [02:07&lt;00:46,  1.35it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:07,700 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 66%|██████▌   | 118/180 [02:08&lt;00:48,  1.27it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:08,604 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=6
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 66%|██████▌   | 119/180 [02:09&lt;00:49,  1.22it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:09,490 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 120/180 [02:10&lt;00:53,  1.13it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 121/180 [02:11&lt;00:43,  1.35it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:10,924 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 68%|██████▊   | 122/180 [02:11&lt;00:42,  1.36it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:11,655 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 68%|██████▊   | 123/180 [02:12&lt;00:39,  1.43it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:12,266 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 69%|██████▉   | 124/180 [02:13&lt;00:39,  1.42it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:12,980 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 69%|██████▉   | 125/180 [02:14&lt;00:44,  1.24it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:14,040 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 126/180 [02:15&lt;00:51,  1.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:15,338 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 71%|███████   | 127/180 [02:16&lt;00:45,  1.18it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:15,944 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 71%|███████   | 128/180 [02:17&lt;00:48,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 72%|███████▏  | 129/180 [02:18&lt;00:50,  1.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 72%|███████▏  | 130/180 [02:18&lt;00:39,  1.26it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:18,519 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 73%|███████▎  | 131/180 [02:19&lt;00:43,  1.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:19,602 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 73%|███████▎  | 132/180 [02:21&lt;00:48,  1.01s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:20,928 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 74%|███████▍  | 133/180 [02:21&lt;00:43,  1.08it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:21,658 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 74%|███████▍  | 134/180 [02:22&lt;00:41,  1.11it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:22,500 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 135/180 [02:23&lt;00:42,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:23,569 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 76%|███████▌  | 136/180 [02:24&lt;00:45,  1.04s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 76%|███████▌  | 137/180 [02:25&lt;00:37,  1.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 77%|███████▋  | 138/180 [02:25&lt;00:30,  1.39it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:25,653 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 77%|███████▋  | 139/180 [02:26&lt;00:28,  1.42it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:26,323 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 78%|███████▊  | 140/180 [02:27&lt;00:34,  1.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:27,533 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 78%|███████▊  | 141/180 [02:29&lt;00:40,  1.04s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:29,004 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 79%|███████▉  | 142/180 [02:30&lt;00:38,  1.02s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:29,961 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 79%|███████▉  | 143/180 [02:31&lt;00:38,  1.03s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:31,040 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|████████  | 144/180 [02:31&lt;00:35,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:31,874 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████  | 145/180 [02:32&lt;00:33,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████  | 146/180 [02:33&lt;00:25,  1.31it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:33,092 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 82%|████████▏ | 147/180 [02:33&lt;00:25,  1.31it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 82%|████████▏ | 148/180 [02:34&lt;00:20,  1.55it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:34,226 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 149/180 [02:35&lt;00:22,  1.35it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:35,181 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 150/180 [02:36&lt;00:23,  1.29it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:36,040 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 84%|████████▍ | 151/180 [02:36&lt;00:21,  1.36it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:36,686 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 84%|████████▍ | 152/180 [02:37&lt;00:22,  1.27it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:37,595 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 85%|████████▌ | 153/180 [02:38&lt;00:20,  1.29it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:12:38,478 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=384
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 86%|████████▌ | 154/180 [03:06&lt;03:50,  8.85s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:06,029 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 86%|████████▌ | 155/180 [03:07&lt;02:46,  6.66s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:07,581 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 87%|████████▋ | 156/180 [03:08&lt;01:58,  4.95s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:08,538 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 87%|████████▋ | 157/180 [03:09&lt;01:26,  3.75s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:09,493 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 88%|████████▊ | 158/180 [03:10&lt;01:01,  2.82s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:10,125 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 88%|████████▊ | 159/180 [03:10&lt;00:45,  2.16s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:10,764 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 89%|████████▉ | 160/180 [03:12&lt;00:39,  1.98s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:12,335 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 89%|████████▉ | 161/180 [03:13&lt;00:33,  1.76s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:13,573 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 90%|█████████ | 162/180 [03:14&lt;00:26,  1.45s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:14,306 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 91%|█████████ | 163/180 [03:15&lt;00:23,  1.35s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:15,427 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 91%|█████████ | 164/180 [03:16&lt;00:19,  1.19s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 92%|█████████▏| 165/180 [03:16&lt;00:13,  1.08it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:16,557 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 92%|█████████▏| 166/180 [03:17&lt;00:12,  1.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:17,288 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|█████████▎| 167/180 [03:18&lt;00:10,  1.19it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:18,067 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|█████████▎| 168/180 [03:19&lt;00:10,  1.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:18,998 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 94%|█████████▍| 169/180 [03:20&lt;00:09,  1.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:19,948 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 94%|█████████▍| 170/180 [03:20&lt;00:07,  1.26it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:20,518 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 95%|█████████▌| 171/180 [03:21&lt;00:07,  1.23it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 96%|█████████▌| 172/180 [03:21&lt;00:05,  1.50it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:21,690 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 96%|█████████▌| 173/180 [03:22&lt;00:05,  1.33it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:22,638 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 97%|█████████▋| 174/180 [03:24&lt;00:05,  1.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:24,158 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 97%|█████████▋| 175/180 [03:25&lt;00:04,  1.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:24,981 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 98%|█████████▊| 176/180 [03:26&lt;00:03,  1.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:26,092 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 98%|█████████▊| 177/180 [03:27&lt;00:03,  1.05s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:27,285 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 99%|█████████▉| 178/180 [03:28&lt;00:02,  1.10s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:28,511 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 99%|█████████▉| 179/180 [03:29&lt;00:01,  1.00s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:29,282 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 180/180 [03:30&lt;00:00,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 180/180 [03:30&lt;00:00,  1.17s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-a-specific-list-of-systems">
<h3>Loading a specific list of systems<a class="headerlink" href="#loading-a-specific-list-of-systems" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">systems</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;1df0__A1_Q07009--1df0__B1_Q64537&quot;</span><span class="p">,</span>
    <span class="s2">&quot;117e__A1_P00817--117e__B1_P00817&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">PinderLoader</span><span class="p">(</span>
    <span class="n">ids</span><span class="o">=</span><span class="n">systems</span><span class="p">,</span>
    <span class="n">monomer_priority</span><span class="o">=</span><span class="s2">&quot;holo&quot;</span><span class="p">,</span>
    <span class="n">base_filters</span> <span class="o">=</span> <span class="n">base_filters</span><span class="p">,</span>
    <span class="n">sub_filters</span> <span class="o">=</span> <span class="n">sub_filters</span>
<span class="p">)</span>
<span class="n">passing_ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">loader</span><span class="p">:</span>
    <span class="n">passing_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="n">systems_removed_by_filters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">passing_ids</span><span class="p">)</span>
<span class="n">systems_removed_by_filters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:30,689 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>set()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">passing_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-pinder-writer">
<h3>Optional Pinder writer<a class="headerlink" href="#optional-pinder-writer" title="Link to this heading">#</a></h3>
<p>Without defining a writer for the <code class="docutils literal notranslate"><span class="pre">PinderLoader</span></code>, the loaded systems are available as a tuple of (<code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code>, <code class="docutils literal notranslate"><span class="pre">Structure</span></code>, <code class="docutils literal notranslate"><span class="pre">Structure</span></code>) objects, containing the original <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> and the sampled feature and target complexes, respectively.</p>
<p>If you want to explicitly write the (potentially transformed) structure objects to a custom location or in a custom format (e.g. PDB, pickle, etc.), you can implement a subclass of <code class="docutils literal notranslate"><span class="pre">PinderWriterBase</span></code>.</p>
<p>The default writer implements writing to PDB files (leveraging the <code class="docutils literal notranslate"><span class="pre">Structure.to_pdb</span></code> method on the structure objects).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader.writer</span> <span class="kn">import</span> <span class="n">PinderDefaultWriter</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>

<span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">PinderLoader</span><span class="p">(</span>
        <span class="n">ids</span><span class="o">=</span><span class="n">systems</span><span class="p">,</span>
        <span class="n">monomer_priority</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">,</span>
        <span class="n">writer</span><span class="o">=</span><span class="n">PinderDefaultWriter</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">systems</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="n">loader</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pinder_id</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span>
        <span class="n">system_dir</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">output_path</span> <span class="o">/</span> <span class="n">pinder_id</span>
        <span class="k">assert</span> <span class="n">system_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">system_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;af_*.pdb&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/tmp/tmphvp65592/117e__A1_P00817--117e__B1_P00817/af__P00817.pdb&#39;)]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/tmp/tmphvp65592/1df0__A1_Q07009--1df0__B1_Q64537/af__Q07009.pdb&#39;), PosixPath(&#39;/tmp/tmphvp65592/1df0__A1_Q07009--1df0__B1_Q64537/af__Q64537.pdb&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="constructing-torch-datasets-and-dataloaders-from-pinder-systems">
<h2>Constructing torch datasets and dataloaders from pinder systems<a class="headerlink" href="#constructing-torch-datasets-and-dataloaders-from-pinder-systems" title="Link to this heading">#</a></h2>
<p>The remaining sections of this tutorial will be for those interested specifically in torch datasets and dataloaders.</p>
<p>Specifically, we will show how to:</p>
<ul class="simple">
<li><p>Implement a PyTorch <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> to interface with pinder data</p></li>
<li><p>Include apo and predicted monomers in the data pipeline, with an option to target specific monomer types or randomly sample from the available types</p></li>
<li><p>Leverage <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> and its associated methods to crop apo/predicted monomers to match the ground-truth holo monomers</p></li>
<li><p>Write filters and transforms that operate on <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects</p></li>
<li><p>Integrate annotations in data filtering and featurization</p></li>
<li><p>Create example features to use for training (you will of course choose your own features)</p></li>
<li><p>Incorporate diversity sampling in the data loader</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">pinder.core.loader.dataset</span></code> module provides two example implementations of how to integrate the pinder dataset into a torch-based machine learning pipeline.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code>: A map-style <code class="docutils literal notranslate"><span class="pre">torch.utils.data.Dataset</span></code> that can be used with torch <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code>’s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PPIDataset</span></code>: A <code class="docutils literal notranslate"><span class="pre">torch_geometric.data.Dataset</span></code> that can be used with torch-geometric <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code>’s. This dataset is designed to be used with the <code class="docutils literal notranslate"><span class="pre">torch_geometric</span></code> package.</p></li>
</ol>
<p>Together, the two datasets provide an example implementation of how to abstract away the complexity of loading and processing multiple structures associated with each <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> by leveraging the following utilities from pinder:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pinder.core.PinderLoader</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pinder.core.loader.filters</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pinder.core.loader.transforms</span></code></p></li>
</ul>
<p>The examples cover two different batch data item structures to illustrate two different use-cases:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code>: A batch of <code class="docutils literal notranslate"><span class="pre">(target_complex,</span> <span class="pre">feature_complex)</span></code> pairs, where <code class="docutils literal notranslate"><span class="pre">target_complex</span></code> and <code class="docutils literal notranslate"><span class="pre">feature_complex</span></code> are <code class="docutils literal notranslate"><span class="pre">torch.Tensor</span></code> objects representing the atomic coordinates and atom types of the holo and sampled (decoy, holo/apo/pred) complexes, respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PPIDataset</span></code>: A batch of <code class="docutils literal notranslate"><span class="pre">PairedPDB</span></code> objects, where the receptor and ligand are encoded separately in a heterogeneous graph, via <code class="docutils literal notranslate"><span class="pre">torch_geometric.data.HeteroData</span></code>, holding multiple node and/or edge types in disjunct storage objects.</p></li>
</ul>
<p>The remaining sections will be split into:</p>
<ol class="arabic simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code> torch dataset</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">PPIDataset</span></code> torch-geometric dataset</p></li>
<li><p>How you could implement your own dataset &amp; dataloader</p></li>
</ol>
<section id="pinderdataset-torch-dataset">
<h3>PinderDataset (torch Dataset)<a class="headerlink" href="#pinderdataset-torch-dataset" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code> is an example implementation of a <code class="docutils literal notranslate"><span class="pre">torch.utils.data.Dataset</span></code> that represents its data items as a dict containing the following key, value pairs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target_complex</span></code>: The ground-truth holo dimer, represented with a set of default properties encoded as <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>’s</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature_complex</span></code>: The sampled dimer complex, representing “features”, also represented with a set of default properties encoded as <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>’s</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code>: The pinder ID for the selected system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_id</span></code>: The IDs of the receptor and ligand holo monomers, concatenated into a single ID string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sample_id</span></code>: The IDs of the sampled receptor and ligand holo monomers, concatenated into a single ID string. This can be useful for debugging purposes or generally tracking which specific monomers are selected when targeting alternative monomers (more on this shortly)</p></li>
</ul>
<p>Each of the <code class="docutils literal notranslate"><span class="pre">target_complex</span></code> and <code class="docutils literal notranslate"><span class="pre">feature_complex</span></code> values are dictionaries with structural properties encoded by the <code class="docutils literal notranslate"><span class="pre">pinder.core.loader.geodata.structure2tensor</span></code> function by default:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">atom_coordinates</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atom_types</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chain_ids</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">residue_coordinates</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">residue_types</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">residue_ids</span></code></p></li>
</ul>
<p><strong>Note: You can choose to use a different representation by overriding the default values of <code class="docutils literal notranslate"><span class="pre">transform</span></code> and <code class="docutils literal notranslate"><span class="pre">target_transform</span></code>. The default transform is the structure2tensor_transform defined in pinder.core.loader.dataset.
It simply takes a <code class="docutils literal notranslate"><span class="pre">Structure</span></code> object and returns a dictionary with string keys and tensor values.</strong></p>
<p>It leverages the <code class="docutils literal notranslate"><span class="pre">PinderLoader</span></code> to apply optional filters and/or transforms, provide an interface for sampling alternative monomers, and exposes <code class="docutils literal notranslate"><span class="pre">transform</span></code> and <code class="docutils literal notranslate"><span class="pre">target_transform</span></code> arguments used by the torch Dataset API.</p>
<p>For more details on the torch Dataset APIs, please refer to the <a class="reference external" href="https://pytorch.org/tutorials/beginner/basics/data_tutorial.html#datasets-dataloaders">tutorials</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader</span> <span class="kn">import</span> <span class="n">filters</span><span class="p">,</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">pinder.core.loader.dataset</span> <span class="kn">import</span> <span class="n">PinderDataset</span><span class="p">,</span> <span class="n">structure2tensor_transform</span>

<span class="n">base_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterByMissingHolo</span><span class="p">(),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterSubByContacts</span><span class="p">(</span><span class="n">min_contacts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">calpha_only</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterDetachedHolo</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_components</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">sub_filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterSubByAtomTypes</span><span class="p">(</span><span class="n">min_atom_types</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterByHoloOverlap</span><span class="p">(</span><span class="n">min_overlap</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterByHoloSeqIdentity</span><span class="p">(</span><span class="n">min_sequence_identity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterSubRmsds</span><span class="p">(</span><span class="n">rmsd_cutoff</span><span class="o">=</span><span class="mf">7.5</span><span class="p">),</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">FilterDetachedSub</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_components</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">]</span>
<span class="c1"># We can include Structure-level transforms (and filters) which will operate on the target and/or feature complexes</span>
<span class="n">structure_transforms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">SelectAtomTypes</span><span class="p">(</span><span class="n">atom_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">])</span>
<span class="p">]</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">PinderDataset</span><span class="p">(</span>
    <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> 
    <span class="c1"># We can leverage holo, apo, pred, random and random_mixed monomer sampling strategies</span>
    <span class="n">monomer_priority</span><span class="o">=</span><span class="s2">&quot;random_mixed&quot;</span><span class="p">,</span>
    <span class="n">base_filters</span> <span class="o">=</span> <span class="n">base_filters</span><span class="p">,</span>
    <span class="n">sub_filters</span> <span class="o">=</span> <span class="n">sub_filters</span><span class="p">,</span>
    <span class="c1"># Apply to the target (ground-truth) complex</span>
    <span class="n">structure_transforms_target</span><span class="o">=</span><span class="n">structure_transforms</span><span class="p">,</span>
    <span class="c1"># Apply to the feature complex</span>
    <span class="n">structure_transforms_feature</span><span class="o">=</span><span class="n">structure_transforms</span><span class="p">,</span>
    <span class="c1"># This is the default transform if not specified</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">structure2tensor_transform</span><span class="p">,</span>
    <span class="n">target_transform</span><span class="o">=</span><span class="n">structure2tensor_transform</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">get_index</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;split == &quot;train&quot;&#39;</span><span class="p">))</span>

<span class="n">train_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pinder.core.loader.dataset.PinderDataset at 0x7f697dd23ac0&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="sampling-alternative-monomers">
<h3>Sampling alternative monomers<a class="headerlink" href="#sampling-alternative-monomers" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">monomer_priority</span></code> argument can be used to target different mixes of bound and unbound monomers to use for creating the decoy/feature complex.</p>
<p>The allowed values for <code class="docutils literal notranslate"><span class="pre">monomer_priority</span></code> are “apo”, “holo”, “pred”, “random” or “random_mixed”.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">monomer_priority</span></code> is set to one of the available monomer types (holo, apo, pred), the same monomer type will be selected for both receptor and ligand.</p>
<p>When the monomer priority is “random”, a random monomer type will be selected from the set of monomer types available for both the receptor and ligand. This option ensures the same type of monomer is used for the receptor and ligand.</p>
<p>When the monomer priority is “random_mixed”, a random monomer type will be selected for each of receptor and ligand, separately.</p>
<p>Enabling the <code class="docutils literal notranslate"><span class="pre">fallback_to_holo</span></code> option (default) will enable silent fallback to holo when the <code class="docutils literal notranslate"><span class="pre">monomer_priority</span></code> is set to one of apo or pred, but the corresponding monomer is not available for the dimer.</p>
<p>This is useful when only one of receptor or ligand has an unbound monomer, but you wish to include apo or predicted structures in your workflow.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fallback_to_holo</span></code> is disabled, an error will be raised when the <code class="docutils literal notranslate"><span class="pre">monomer_priority</span></code> is set to one of apo or pred, but the corresponding monomer is not available for the dimer.</p>
<p>By default, when apo monomers are selected, the “canonical” apo monomer is used. Although a single canonical apo monomer should be used for eval, pinder provides multiple apo monomers paired to a single holo monomer (when available). In order to include these non-canonical/alternative monomers, you can specify <code class="docutils literal notranslate"><span class="pre">use_canonical_apo=False</span></code> when constructing the <code class="docutils literal notranslate"><span class="pre">PinderLoader</span></code> or <code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code> objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_item</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">data_item</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;target_complex&#39;: {&#39;atom_types&#39;: tensor([[0.],
          [1.],
          [2.],
          ...,
          [1.],
          [2.],
          [3.]]),
  &#39;element_types&#39;: tensor([[3.],
          [0.],
          [0.],
          ...,
          [0.],
          [0.],
          [2.]]),
  &#39;residue_types&#39;: tensor([[16.],
          [16.],
          [16.],
          ...,
          [ 0.],
          [ 0.],
          [ 0.]]),
  &#39;atom_coordinates&#39;: tensor([[131.7500, 429.3090, 163.5360],
          [132.6810, 428.2520, 163.1550],
          [133.5150, 428.6750, 161.9500],
          ...,
          [177.7620, 463.8650, 166.9020],
          [177.4130, 465.0800, 167.7550],
          [176.8000, 464.9490, 168.8150]]),
  &#39;residue_coordinates&#39;: tensor([[132.6810, 428.2520, 163.1550],
          [133.5560, 429.2490, 159.5910],
          [133.8750, 432.8980, 160.6290],
          [136.1110, 431.8050, 163.5130],
          [138.3420, 429.8920, 161.0830],
          [138.5230, 432.9090, 158.7600],
          [139.4710, 435.1730, 161.6750],
          [142.1200, 432.6310, 162.6740],
          [143.5890, 432.7500, 159.1600],
          [143.6190, 436.5600, 159.1540],
          [145.2600, 436.8040, 162.5830],
          [147.8380, 434.1320, 161.7330],
          [148.7390, 435.8920, 158.4790],
          [149.0640, 439.2630, 160.2240],
          [151.2220, 437.7670, 162.9840],
          [153.4710, 435.8030, 160.6120],
          [153.9420, 438.9180, 158.4710],
          [156.1140, 440.2660, 161.3150],
          [158.3330, 437.1860, 161.4250],
          [161.8090, 436.4120, 160.1100],
          [161.1120, 432.8370, 158.9350],
          [157.4020, 432.0710, 159.3930],
          [156.5290, 428.3870, 159.0310],
          [154.0400, 428.1160, 156.1500],
          [153.3520, 424.6590, 154.7510],
          [152.8370, 424.8210, 150.9870],
          [150.9700, 422.4160, 148.7320],
          [153.5900, 422.6860, 145.9670],
          [157.3050, 423.3410, 145.6600],
          [158.4860, 426.6730, 144.2700],
          [160.7730, 427.0880, 141.2590],
          [163.9630, 429.0530, 141.9600],
          [166.4230, 427.4330, 139.5550],
          [167.6170, 430.8330, 138.3250],
          [170.5180, 431.9210, 140.5320],
          [169.7800, 435.6680, 140.3160],
          [167.6790, 437.8790, 142.6110],
          [167.3350, 435.1910, 145.2890],
          [168.9090, 437.3000, 148.0580],
          [166.1860, 439.9440, 148.5750],
          [164.1010, 438.1300, 151.1890],
          [163.0190, 438.8690, 154.7450],
          [164.6750, 435.6560, 155.9860],
          [168.1170, 436.6550, 154.6330],
          [169.8040, 437.0930, 158.0010],
          [173.2680, 438.4850, 158.5750],
          [174.9270, 440.8490, 156.1460],
          [175.9170, 440.8010, 152.5000],
          [179.6060, 441.0910, 153.4330],
          [180.8000, 439.9830, 156.8710],
          [184.2540, 439.9980, 158.4580],
          [185.5840, 437.2970, 160.7670],
          [186.4140, 439.9000, 163.4480],
          [182.9430, 441.4570, 163.7500],
          [181.4930, 442.0910, 167.2100],
          [178.0780, 440.5360, 167.9060],
          [176.1650, 440.9290, 171.1790],
          [173.0530, 438.9530, 172.1310],
          [170.3990, 440.6990, 174.2170],
          [166.7880, 440.0710, 175.2260],
          [164.4480, 442.1010, 173.0340],
          [160.9780, 443.6110, 173.3810],
          [158.8330, 443.9000, 170.2730],
          [160.1820, 442.9360, 166.8360],
          [163.5010, 444.7230, 166.1630],
          [164.6310, 442.4290, 163.3160],
          [166.6330, 444.2560, 160.6240],
          [166.1700, 447.5210, 162.5220],
          [168.1350, 449.9450, 164.6440],
          [168.0040, 449.0470, 168.3240],
          [168.4210, 451.0540, 171.5220],
          [169.0440, 450.0360, 175.1300],
          [166.1650, 450.3680, 177.6100],
          [166.7800, 449.8300, 181.3340],
          [163.8480, 448.9150, 183.5760],
          [163.3500, 443.9770, 187.9750],
          [165.0240, 442.4930, 184.8870],
          [168.1120, 443.0980, 182.7810],
          [168.1280, 445.9210, 180.2050],
          [166.7230, 445.0130, 176.8030],
          [167.0690, 446.1330, 173.1930],
          [164.0790, 447.8390, 171.5780],
          [163.4630, 449.0630, 168.0350],
          [164.4160, 452.7320, 168.0130],
          [166.7460, 455.3190, 166.5790],
          [167.5460, 459.0090, 166.8440],
          [170.2010, 459.9620, 169.3810],
          [169.5150, 456.8220, 171.4570],
          [170.7440, 454.3880, 168.7860],
          [172.8900, 451.6810, 170.3850],
          [173.2420, 449.3000, 167.4490],
          [171.4700, 447.3670, 164.7150],
          [169.7840, 443.9650, 164.9670],
          [170.8880, 441.4120, 162.3680],
          [169.3320, 438.1640, 163.6510],
          [166.7170, 436.9060, 166.1030],
          [166.2830, 433.5290, 167.7900],
          [162.5490, 433.4260, 168.5040],
          [162.6440, 430.3540, 170.7620],
          [164.9490, 432.1120, 173.2350],
          [163.6530, 435.5760, 172.2210],
          [167.2540, 436.7450, 171.8300],
          [168.3710, 439.3650, 169.3060],
          [171.8910, 439.6680, 167.8930],
          [173.1360, 443.2500, 167.5870],
          [176.0990, 444.7950, 165.8030],
          [177.1670, 447.8660, 167.8270],
          [177.4160, 451.2430, 166.1360],
          [181.1790, 451.0810, 166.7480],
          [181.3560, 448.4350, 163.9980],
          [180.6020, 448.8920, 160.3060],
          [177.8440, 446.8990, 158.6170],
          [176.7540, 446.3160, 155.0150],
          [173.3820, 444.6900, 154.4770],
          [169.6430, 444.9660, 153.9760],
          [167.6080, 446.9450, 156.5140],
          [163.9630, 447.9270, 156.8800],
          [163.1520, 451.2160, 155.1430],
          [160.3870, 453.6570, 156.0420],
          [158.9330, 453.6920, 152.5150],
          [159.8050, 453.2460, 148.8360],
          [161.2560, 456.7540, 148.4440],
          [164.9420, 455.8330, 148.8520],
          [167.3780, 455.9500, 145.9260],
          [171.0380, 455.0610, 145.5060],
          [173.5830, 457.5340, 146.9270],
          [171.2360, 458.9430, 149.5740],
          [171.8150, 459.8640, 153.2130],
          [169.5910, 457.9090, 155.6000],
          [168.4960, 458.3960, 159.2100],
          [167.0870, 455.9020, 161.7110],
          [163.6430, 457.0390, 162.8610],
          [161.8700, 456.3550, 166.1660],
          [160.7490, 452.9260, 164.8950],
          [164.2440, 451.8750, 163.8110],
          [163.4490, 452.3040, 160.1090],
          [165.6820, 454.0140, 157.5590],
          [164.2940, 457.2310, 156.0670],
          [165.6810, 459.7290, 153.5780],
          [167.3870, 462.7790, 155.0760],
          [170.2060, 465.8340, 161.8360],
          [172.1620, 462.7680, 160.6890],
          [174.0280, 461.7040, 163.8180],
          [175.2110, 458.5660, 161.9930],
          [176.5410, 458.2410, 158.4450],
          [174.5550, 455.7530, 156.3540],
          [174.3580, 455.6030, 152.5600],
          [171.8590, 453.6260, 150.4910],
          [173.6300, 451.2730, 148.0810],
          [170.4820, 450.1750, 146.2000],
          [166.8520, 451.1980, 145.7810],
          [164.0730, 450.1880, 148.1490],
          [162.6710, 446.7750, 147.1980],
          [159.1420, 445.8080, 148.2240],
          [158.3160, 442.3640, 149.5950],
          [155.0300, 443.1470, 151.4050],
          [152.6800, 446.0960, 151.8500],
          [155.0610, 447.4890, 154.4910],
          [158.2010, 445.3460, 154.0190],
          [160.8090, 447.5340, 152.2870],
          [164.4130, 446.3150, 152.1360],
          [167.3360, 448.5380, 151.1380],
          [171.0310, 447.6630, 150.9500],
          [172.8160, 450.1440, 153.2260],
          [176.3550, 450.4540, 154.5850],
          [176.6310, 452.0780, 158.0240],
          [180.1600, 453.0970, 159.0310],
          [179.9110, 454.9710, 162.3160],
          [178.7370, 458.4030, 163.4610],
          [179.1350, 461.9150, 162.0830],
          [180.3160, 464.9940, 163.9950],
          [195.1700, 454.0210, 194.1160],
          [196.4220, 450.5570, 193.1610],
          [195.0530, 447.5260, 191.3340],
          [195.7530, 445.4320, 194.4410],
          [195.6760, 446.8960, 197.9710],
          [199.1230, 447.9300, 199.1640],
          [198.4070, 447.0140, 202.7840],
          [198.1130, 443.3080, 203.5090],
          [195.0350, 441.7530, 205.1060],
          [194.7040, 440.1720, 208.5300],
          [191.7420, 437.9460, 207.6670],
          [190.9460, 435.0990, 205.3140],
          [188.0870, 435.6760, 202.8880],
          [184.8300, 433.7320, 203.1830],
          [184.1270, 431.8260, 199.9570],
          [180.5450, 430.8500, 200.7460],
          [178.2470, 433.3320, 199.0220],
          [178.2770, 433.9260, 195.2680],
          [176.3170, 437.2030, 195.0280],
          [177.7690, 440.7330, 194.9660],
          [181.3350, 439.3910, 195.1330],
          [182.5820, 441.3460, 192.0940],
          [182.3530, 444.9560, 193.3610],
          [186.0870, 445.2240, 194.0290],
          [188.7230, 447.5570, 192.6190],
          [190.8760, 444.5870, 191.5490],
          [188.2670, 443.5230, 188.9590],
          [190.1360, 444.3010, 185.7360],
          [188.8140, 444.1990, 182.1980],
          [185.1300, 444.1560, 181.3470],
          [182.1290, 442.2030, 182.6060],
          [181.3330, 441.2700, 178.9860],
          [184.3690, 440.6570, 176.7700],
          [184.4240, 439.7520, 173.0740],
          [187.1540, 437.5560, 171.6020],
          [187.5170, 439.9750, 168.6500],
          [188.4180, 443.0500, 170.7240],
          [191.4360, 445.2100, 169.8910],
          [193.7480, 445.6510, 172.8940],
          [196.8200, 447.8990, 173.0280],
          [199.4910, 448.6120, 175.6310],
          [201.2080, 451.9090, 176.3780],
          [203.6110, 453.4740, 178.8680],
          [201.6130, 454.9210, 181.7570],
          [202.0690, 458.3840, 183.2730],
          [200.4970, 458.3690, 186.7180],
          [197.7960, 455.8130, 187.5240],
          [195.1460, 455.8470, 184.7720],
          [193.6160, 452.5740, 185.9790],
          [189.8600, 452.3800, 185.3150],
          [189.9440, 455.8580, 183.7680],
          [189.7400, 457.4310, 180.3410],
          [193.1630, 457.9480, 178.8100],
          [194.6770, 460.5170, 176.4640],
          [197.9720, 460.6430, 174.6010],
          [200.7710, 462.5710, 176.3210],
          [203.7970, 463.7400, 174.3330],
          [207.1150, 464.5820, 175.9770],
          [210.1390, 466.5260, 174.8060],
          [210.8850, 463.9390, 172.1200],
          [213.6440, 461.8050, 173.6150],
          [211.1280, 459.2430, 174.9140],
          [208.0390, 457.7610, 173.2930],
          [204.4770, 458.9110, 173.9310],
          [202.5240, 457.8000, 177.0030],
          [198.9190, 457.7220, 178.2440],
          [197.5730, 459.9040, 181.0500],
          [194.2310, 460.2350, 182.8060],
          [192.1140, 462.6430, 180.7850],
          [189.0250, 463.1720, 178.7000],
          [187.1240, 465.8360, 176.8220],
          [188.2850, 466.3320, 173.2420],
          [191.5580, 464.4520, 173.8600],
          [189.9950, 461.1280, 174.9010],
          [191.8440, 458.2970, 173.1540],
          [190.4670, 455.2690, 174.9900],
          [189.7380, 453.5820, 178.3070],
          [192.3390, 451.8830, 180.5000],
          [191.2020, 448.5340, 181.9050],
          [194.3800, 447.0280, 183.4050],
          [197.8700, 447.9650, 184.5850],
          [200.9840, 445.8270, 184.9660],
          [202.8290, 447.6220, 187.7590],
          [206.2120, 445.9180, 187.3400],
          [206.6040, 447.1310, 183.7460],
          [204.4430, 450.2380, 184.1830],
          [202.2310, 449.1370, 181.2890],
          [198.6660, 450.3790, 180.7720],
          [196.2310, 448.2490, 178.7680],
          [194.0550, 450.4240, 176.5260],
          [190.8490, 449.7090, 174.6070],
          [190.4360, 452.3080, 171.8240],
          [187.3830, 454.5590, 171.7980],
          [186.4670, 452.9730, 168.4480],
          [185.9050, 449.6480, 170.2580],
          [182.8890, 448.8910, 172.4330],
          [183.5680, 448.6030, 176.1630],
          [181.3330, 447.5400, 179.0590],
          [182.7340, 447.5270, 182.5670],
          [183.3280, 449.2260, 185.8920],
          [184.8760, 452.6980, 185.6990],
          [185.7140, 455.4170, 188.2030],
          [182.9420, 457.9530, 188.8300],
          [183.2930, 461.5650, 189.9350],
          [182.7580, 462.1320, 193.6660],
          [180.0620, 464.7490, 193.1030],
          [176.4120, 463.9030, 192.5790],
          [177.1550, 460.1730, 192.6930],
          [173.8180, 459.5980, 194.4390],
          [172.0770, 461.1030, 191.4040],
          [173.6950, 458.5410, 189.0910],
          [171.0060, 456.0190, 188.1270],
          [170.8210, 453.3390, 185.4210],
          [170.0180, 454.8270, 182.0350],
          [171.8690, 458.1080, 182.6590],
          [174.2320, 459.6520, 180.1210],
          [177.8640, 459.9130, 181.2230],
          [180.8780, 461.8410, 179.9490],
          [184.5650, 461.8070, 180.8430],
          [186.0650, 464.7990, 182.6440],
          [189.5780, 466.2740, 182.6170],
          [190.7120, 463.6340, 185.1390],
          [189.2980, 460.6630, 183.2290],
          [186.3560, 460.3000, 185.6240],
          [182.7840, 459.6590, 184.5210],
          [180.2130, 462.3320, 185.3590],
          [176.5320, 462.8410, 184.6140],
          [175.8580, 465.0300, 181.5790],
          [178.1930, 465.7110, 174.9000],
          [180.9150, 464.1190, 172.7670],
          [181.2510, 460.5420, 174.1130],
          [178.4430, 457.9660, 174.2140],
          [178.5420, 456.4790, 177.7180],
          [175.4730, 455.1590, 179.5500],
          [175.4670, 454.0690, 183.1870],
          [174.1210, 450.5430, 183.6830],
          [173.9850, 450.6340, 187.5030],
          [174.3640, 452.9240, 190.5240],
          [177.5140, 454.2200, 192.1820],
          [179.3060, 451.6570, 194.3540],
          [181.4890, 453.2110, 197.0570],
          [184.7390, 451.3110, 197.6330],
          [186.4870, 454.0230, 199.6690],
          [185.5270, 457.3810, 201.1790],
          [186.7910, 459.0050, 197.9610],
          [186.6010, 456.0430, 195.5320],
          [183.3680, 455.3620, 193.6270],
          [182.9110, 452.9430, 190.7280],
          [180.0190, 452.5230, 188.3060],
          [179.0910, 450.0250, 185.5960],
          [178.9850, 451.7840, 182.2280],
          [179.0510, 451.0080, 178.5100],
          [181.0530, 453.1550, 176.0780],
          [180.1320, 452.7170, 172.4060],
          [182.0570, 455.4530, 170.6120],
          [181.8140, 459.1820, 170.0770],
          [178.5990, 461.0580, 169.3130],
          [177.7620, 463.8650, 166.9020]]),
  &#39;residue_ids&#39;: tensor([  4.,   4.,   4.,  ..., 182., 182., 182.]),
  &#39;chain_ids&#39;: tensor([0., 0., 0.,  ..., 1., 1., 1.])},
 &#39;feature_complex&#39;: {&#39;atom_types&#39;: tensor([[0.],
          [1.],
          [2.],
          ...,
          [1.],
          [2.],
          [3.]]),
  &#39;element_types&#39;: tensor([[3.],
          [0.],
          [0.],
          ...,
          [0.],
          [0.],
          [2.]]),
  &#39;residue_types&#39;: tensor([[16.],
          [16.],
          [16.],
          ...,
          [ 0.],
          [ 0.],
          [ 0.]]),
  &#39;atom_coordinates&#39;: tensor([[131.7500, 429.3090, 163.5360],
          [132.6810, 428.2520, 163.1550],
          [133.5150, 428.6750, 161.9500],
          ...,
          [177.7620, 463.8650, 166.9020],
          [177.4130, 465.0800, 167.7550],
          [176.8000, 464.9490, 168.8150]]),
  &#39;residue_coordinates&#39;: tensor([[132.6810, 428.2520, 163.1550],
          [133.5560, 429.2490, 159.5910],
          [133.8750, 432.8980, 160.6290],
          [136.1110, 431.8050, 163.5130],
          [138.3420, 429.8920, 161.0830],
          [138.5230, 432.9090, 158.7600],
          [139.4710, 435.1730, 161.6750],
          [142.1200, 432.6310, 162.6740],
          [143.5890, 432.7500, 159.1600],
          [143.6190, 436.5600, 159.1540],
          [145.2600, 436.8040, 162.5830],
          [147.8380, 434.1320, 161.7330],
          [148.7390, 435.8920, 158.4790],
          [149.0640, 439.2630, 160.2240],
          [151.2220, 437.7670, 162.9840],
          [153.4710, 435.8030, 160.6120],
          [153.9420, 438.9180, 158.4710],
          [156.1140, 440.2660, 161.3150],
          [158.3330, 437.1860, 161.4250],
          [161.8090, 436.4120, 160.1100],
          [161.1120, 432.8370, 158.9350],
          [157.4020, 432.0710, 159.3930],
          [156.5290, 428.3870, 159.0310],
          [154.0400, 428.1160, 156.1500],
          [153.3520, 424.6590, 154.7510],
          [152.8370, 424.8210, 150.9870],
          [150.9700, 422.4160, 148.7320],
          [153.5900, 422.6860, 145.9670],
          [157.3050, 423.3410, 145.6600],
          [158.4860, 426.6730, 144.2700],
          [160.7730, 427.0880, 141.2590],
          [163.9630, 429.0530, 141.9600],
          [166.4230, 427.4330, 139.5550],
          [167.6170, 430.8330, 138.3250],
          [170.5180, 431.9210, 140.5320],
          [169.7800, 435.6680, 140.3160],
          [167.6790, 437.8790, 142.6110],
          [167.3350, 435.1910, 145.2890],
          [168.9090, 437.3000, 148.0580],
          [166.1860, 439.9440, 148.5750],
          [164.1010, 438.1300, 151.1890],
          [163.0190, 438.8690, 154.7450],
          [164.6750, 435.6560, 155.9860],
          [168.1170, 436.6550, 154.6330],
          [169.8040, 437.0930, 158.0010],
          [173.2680, 438.4850, 158.5750],
          [174.9270, 440.8490, 156.1460],
          [175.9170, 440.8010, 152.5000],
          [179.6060, 441.0910, 153.4330],
          [180.8000, 439.9830, 156.8710],
          [184.2540, 439.9980, 158.4580],
          [185.5840, 437.2970, 160.7670],
          [186.4140, 439.9000, 163.4480],
          [182.9430, 441.4570, 163.7500],
          [181.4930, 442.0910, 167.2100],
          [178.0780, 440.5360, 167.9060],
          [176.1650, 440.9290, 171.1790],
          [173.0530, 438.9530, 172.1310],
          [170.3990, 440.6990, 174.2170],
          [166.7880, 440.0710, 175.2260],
          [164.4480, 442.1010, 173.0340],
          [160.9780, 443.6110, 173.3810],
          [158.8330, 443.9000, 170.2730],
          [160.1820, 442.9360, 166.8360],
          [163.5010, 444.7230, 166.1630],
          [164.6310, 442.4290, 163.3160],
          [166.6330, 444.2560, 160.6240],
          [166.1700, 447.5210, 162.5220],
          [168.1350, 449.9450, 164.6440],
          [168.0040, 449.0470, 168.3240],
          [168.4210, 451.0540, 171.5220],
          [169.0440, 450.0360, 175.1300],
          [166.1650, 450.3680, 177.6100],
          [166.7800, 449.8300, 181.3340],
          [163.8480, 448.9150, 183.5760],
          [163.3500, 443.9770, 187.9750],
          [165.0240, 442.4930, 184.8870],
          [168.1120, 443.0980, 182.7810],
          [168.1280, 445.9210, 180.2050],
          [166.7230, 445.0130, 176.8030],
          [167.0690, 446.1330, 173.1930],
          [164.0790, 447.8390, 171.5780],
          [163.4630, 449.0630, 168.0350],
          [164.4160, 452.7320, 168.0130],
          [166.7460, 455.3190, 166.5790],
          [167.5460, 459.0090, 166.8440],
          [170.2010, 459.9620, 169.3810],
          [169.5150, 456.8220, 171.4570],
          [170.7440, 454.3880, 168.7860],
          [172.8900, 451.6810, 170.3850],
          [173.2420, 449.3000, 167.4490],
          [171.4700, 447.3670, 164.7150],
          [169.7840, 443.9650, 164.9670],
          [170.8880, 441.4120, 162.3680],
          [169.3320, 438.1640, 163.6510],
          [166.7170, 436.9060, 166.1030],
          [166.2830, 433.5290, 167.7900],
          [162.5490, 433.4260, 168.5040],
          [162.6440, 430.3540, 170.7620],
          [164.9490, 432.1120, 173.2350],
          [163.6530, 435.5760, 172.2210],
          [167.2540, 436.7450, 171.8300],
          [168.3710, 439.3650, 169.3060],
          [171.8910, 439.6680, 167.8930],
          [173.1360, 443.2500, 167.5870],
          [176.0990, 444.7950, 165.8030],
          [177.1670, 447.8660, 167.8270],
          [177.4160, 451.2430, 166.1360],
          [181.1790, 451.0810, 166.7480],
          [181.3560, 448.4350, 163.9980],
          [180.6020, 448.8920, 160.3060],
          [177.8440, 446.8990, 158.6170],
          [176.7540, 446.3160, 155.0150],
          [173.3820, 444.6900, 154.4770],
          [169.6430, 444.9660, 153.9760],
          [167.6080, 446.9450, 156.5140],
          [163.9630, 447.9270, 156.8800],
          [163.1520, 451.2160, 155.1430],
          [160.3870, 453.6570, 156.0420],
          [158.9330, 453.6920, 152.5150],
          [159.8050, 453.2460, 148.8360],
          [161.2560, 456.7540, 148.4440],
          [164.9420, 455.8330, 148.8520],
          [167.3780, 455.9500, 145.9260],
          [171.0380, 455.0610, 145.5060],
          [173.5830, 457.5340, 146.9270],
          [171.2360, 458.9430, 149.5740],
          [171.8150, 459.8640, 153.2130],
          [169.5910, 457.9090, 155.6000],
          [168.4960, 458.3960, 159.2100],
          [167.0870, 455.9020, 161.7110],
          [163.6430, 457.0390, 162.8610],
          [161.8700, 456.3550, 166.1660],
          [160.7490, 452.9260, 164.8950],
          [164.2440, 451.8750, 163.8110],
          [163.4490, 452.3040, 160.1090],
          [165.6820, 454.0140, 157.5590],
          [164.2940, 457.2310, 156.0670],
          [165.6810, 459.7290, 153.5780],
          [167.3870, 462.7790, 155.0760],
          [170.2060, 465.8340, 161.8360],
          [172.1620, 462.7680, 160.6890],
          [174.0280, 461.7040, 163.8180],
          [175.2110, 458.5660, 161.9930],
          [176.5410, 458.2410, 158.4450],
          [174.5550, 455.7530, 156.3540],
          [174.3580, 455.6030, 152.5600],
          [171.8590, 453.6260, 150.4910],
          [173.6300, 451.2730, 148.0810],
          [170.4820, 450.1750, 146.2000],
          [166.8520, 451.1980, 145.7810],
          [164.0730, 450.1880, 148.1490],
          [162.6710, 446.7750, 147.1980],
          [159.1420, 445.8080, 148.2240],
          [158.3160, 442.3640, 149.5950],
          [155.0300, 443.1470, 151.4050],
          [152.6800, 446.0960, 151.8500],
          [155.0610, 447.4890, 154.4910],
          [158.2010, 445.3460, 154.0190],
          [160.8090, 447.5340, 152.2870],
          [164.4130, 446.3150, 152.1360],
          [167.3360, 448.5380, 151.1380],
          [171.0310, 447.6630, 150.9500],
          [172.8160, 450.1440, 153.2260],
          [176.3550, 450.4540, 154.5850],
          [176.6310, 452.0780, 158.0240],
          [180.1600, 453.0970, 159.0310],
          [179.9110, 454.9710, 162.3160],
          [178.7370, 458.4030, 163.4610],
          [179.1350, 461.9150, 162.0830],
          [180.3160, 464.9940, 163.9950],
          [195.1700, 454.0210, 194.1160],
          [196.4220, 450.5570, 193.1610],
          [195.0530, 447.5260, 191.3340],
          [195.7530, 445.4320, 194.4410],
          [195.6760, 446.8960, 197.9710],
          [199.1230, 447.9300, 199.1640],
          [198.4070, 447.0140, 202.7840],
          [198.1130, 443.3080, 203.5090],
          [195.0350, 441.7530, 205.1060],
          [194.7040, 440.1720, 208.5300],
          [191.7420, 437.9460, 207.6670],
          [190.9460, 435.0990, 205.3140],
          [188.0870, 435.6760, 202.8880],
          [184.8300, 433.7320, 203.1830],
          [184.1270, 431.8260, 199.9570],
          [180.5450, 430.8500, 200.7460],
          [178.2470, 433.3320, 199.0220],
          [178.2770, 433.9260, 195.2680],
          [176.3170, 437.2030, 195.0280],
          [177.7690, 440.7330, 194.9660],
          [181.3350, 439.3910, 195.1330],
          [182.5820, 441.3460, 192.0940],
          [182.3530, 444.9560, 193.3610],
          [186.0870, 445.2240, 194.0290],
          [188.7230, 447.5570, 192.6190],
          [190.8760, 444.5870, 191.5490],
          [188.2670, 443.5230, 188.9590],
          [190.1360, 444.3010, 185.7360],
          [188.8140, 444.1990, 182.1980],
          [185.1300, 444.1560, 181.3470],
          [182.1290, 442.2030, 182.6060],
          [181.3330, 441.2700, 178.9860],
          [184.3690, 440.6570, 176.7700],
          [184.4240, 439.7520, 173.0740],
          [187.1540, 437.5560, 171.6020],
          [187.5170, 439.9750, 168.6500],
          [188.4180, 443.0500, 170.7240],
          [191.4360, 445.2100, 169.8910],
          [193.7480, 445.6510, 172.8940],
          [196.8200, 447.8990, 173.0280],
          [199.4910, 448.6120, 175.6310],
          [201.2080, 451.9090, 176.3780],
          [203.6110, 453.4740, 178.8680],
          [201.6130, 454.9210, 181.7570],
          [202.0690, 458.3840, 183.2730],
          [200.4970, 458.3690, 186.7180],
          [197.7960, 455.8130, 187.5240],
          [195.1460, 455.8470, 184.7720],
          [193.6160, 452.5740, 185.9790],
          [189.8600, 452.3800, 185.3150],
          [189.9440, 455.8580, 183.7680],
          [189.7400, 457.4310, 180.3410],
          [193.1630, 457.9480, 178.8100],
          [194.6770, 460.5170, 176.4640],
          [197.9720, 460.6430, 174.6010],
          [200.7710, 462.5710, 176.3210],
          [203.7970, 463.7400, 174.3330],
          [207.1150, 464.5820, 175.9770],
          [210.1390, 466.5260, 174.8060],
          [210.8850, 463.9390, 172.1200],
          [213.6440, 461.8050, 173.6150],
          [211.1280, 459.2430, 174.9140],
          [208.0390, 457.7610, 173.2930],
          [204.4770, 458.9110, 173.9310],
          [202.5240, 457.8000, 177.0030],
          [198.9190, 457.7220, 178.2440],
          [197.5730, 459.9040, 181.0500],
          [194.2310, 460.2350, 182.8060],
          [192.1140, 462.6430, 180.7850],
          [189.0250, 463.1720, 178.7000],
          [187.1240, 465.8360, 176.8220],
          [188.2850, 466.3320, 173.2420],
          [191.5580, 464.4520, 173.8600],
          [189.9950, 461.1280, 174.9010],
          [191.8440, 458.2970, 173.1540],
          [190.4670, 455.2690, 174.9900],
          [189.7380, 453.5820, 178.3070],
          [192.3390, 451.8830, 180.5000],
          [191.2020, 448.5340, 181.9050],
          [194.3800, 447.0280, 183.4050],
          [197.8700, 447.9650, 184.5850],
          [200.9840, 445.8270, 184.9660],
          [202.8290, 447.6220, 187.7590],
          [206.2120, 445.9180, 187.3400],
          [206.6040, 447.1310, 183.7460],
          [204.4430, 450.2380, 184.1830],
          [202.2310, 449.1370, 181.2890],
          [198.6660, 450.3790, 180.7720],
          [196.2310, 448.2490, 178.7680],
          [194.0550, 450.4240, 176.5260],
          [190.8490, 449.7090, 174.6070],
          [190.4360, 452.3080, 171.8240],
          [187.3830, 454.5590, 171.7980],
          [186.4670, 452.9730, 168.4480],
          [185.9050, 449.6480, 170.2580],
          [182.8890, 448.8910, 172.4330],
          [183.5680, 448.6030, 176.1630],
          [181.3330, 447.5400, 179.0590],
          [182.7340, 447.5270, 182.5670],
          [183.3280, 449.2260, 185.8920],
          [184.8760, 452.6980, 185.6990],
          [185.7140, 455.4170, 188.2030],
          [182.9420, 457.9530, 188.8300],
          [183.2930, 461.5650, 189.9350],
          [182.7580, 462.1320, 193.6660],
          [180.0620, 464.7490, 193.1030],
          [176.4120, 463.9030, 192.5790],
          [177.1550, 460.1730, 192.6930],
          [173.8180, 459.5980, 194.4390],
          [172.0770, 461.1030, 191.4040],
          [173.6950, 458.5410, 189.0910],
          [171.0060, 456.0190, 188.1270],
          [170.8210, 453.3390, 185.4210],
          [170.0180, 454.8270, 182.0350],
          [171.8690, 458.1080, 182.6590],
          [174.2320, 459.6520, 180.1210],
          [177.8640, 459.9130, 181.2230],
          [180.8780, 461.8410, 179.9490],
          [184.5650, 461.8070, 180.8430],
          [186.0650, 464.7990, 182.6440],
          [189.5780, 466.2740, 182.6170],
          [190.7120, 463.6340, 185.1390],
          [189.2980, 460.6630, 183.2290],
          [186.3560, 460.3000, 185.6240],
          [182.7840, 459.6590, 184.5210],
          [180.2130, 462.3320, 185.3590],
          [176.5320, 462.8410, 184.6140],
          [175.8580, 465.0300, 181.5790],
          [178.1930, 465.7110, 174.9000],
          [180.9150, 464.1190, 172.7670],
          [181.2510, 460.5420, 174.1130],
          [178.4430, 457.9660, 174.2140],
          [178.5420, 456.4790, 177.7180],
          [175.4730, 455.1590, 179.5500],
          [175.4670, 454.0690, 183.1870],
          [174.1210, 450.5430, 183.6830],
          [173.9850, 450.6340, 187.5030],
          [174.3640, 452.9240, 190.5240],
          [177.5140, 454.2200, 192.1820],
          [179.3060, 451.6570, 194.3540],
          [181.4890, 453.2110, 197.0570],
          [184.7390, 451.3110, 197.6330],
          [186.4870, 454.0230, 199.6690],
          [185.5270, 457.3810, 201.1790],
          [186.7910, 459.0050, 197.9610],
          [186.6010, 456.0430, 195.5320],
          [183.3680, 455.3620, 193.6270],
          [182.9110, 452.9430, 190.7280],
          [180.0190, 452.5230, 188.3060],
          [179.0910, 450.0250, 185.5960],
          [178.9850, 451.7840, 182.2280],
          [179.0510, 451.0080, 178.5100],
          [181.0530, 453.1550, 176.0780],
          [180.1320, 452.7170, 172.4060],
          [182.0570, 455.4530, 170.6120],
          [181.8140, 459.1820, 170.0770],
          [178.5990, 461.0580, 169.3130],
          [177.7620, 463.8650, 166.9020]]),
  &#39;residue_ids&#39;: tensor([  4.,   4.,   4.,  ..., 182., 182., 182.]),
  &#39;chain_ids&#39;: tensor([0., 0., 0.,  ..., 1., 1., 1.])},
 &#39;id&#39;: &#39;8phr__X4_UNDEFINED--8phr__W4_UNDEFINED&#39;,
 &#39;sample_id&#39;: &#39;8phr__X4_UNDEFINED-R--8phr__W4_UNDEFINED-L&#39;,
 &#39;target_id&#39;: &#39;8phr__X4_UNDEFINED-R--8phr__W4_UNDEFINED-L&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Since we used the default option of crop_equal_monomer_shapes, we should expect feature and target complex coords are identical shapes</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">data_item</span><span class="p">[</span><span class="s2">&quot;feature_complex&quot;</span><span class="p">][</span><span class="s2">&quot;atom_coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
    <span class="o">==</span> <span class="n">data_item</span><span class="p">[</span><span class="s2">&quot;target_complex&quot;</span><span class="p">][</span><span class="s2">&quot;atom_coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="p">)</span>

<span class="n">data_item</span><span class="p">[</span><span class="s2">&quot;feature_complex&quot;</span><span class="p">][</span><span class="s2">&quot;atom_coordinates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>torch.Size([1316, 3])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">PinderDataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on class PinderDataset in module pinder.core.loader.dataset:

class PinderDataset(torch.utils.data.dataset.Dataset)
 |  PinderDataset(split: &#39;str | None&#39; = None, index: &#39;pd.DataFrame | None&#39; = None, metadata: &#39;pd.DataFrame | None&#39; = None, monomer_priority: &#39;str&#39; = &#39;holo&#39;, base_filters: &#39;list[PinderFilterBase]&#39; = [], sub_filters: &#39;list[PinderFilterSubBase]&#39; = [], structure_filters: &#39;list[StructureFilter]&#39; = [], structure_transforms_target: &#39;list[StructureTransform]&#39; = [], structure_transforms_feature: &#39;list[StructureTransform]&#39; = [], transform: &#39;Callable[[Structure], torch.Tensor | dict[str, torch.Tensor]]&#39; = &lt;function structure2tensor_transform at 0x7f69602b55a0&gt;, target_transform: &#39;Callable[[Structure], torch.Tensor | dict[str, torch.Tensor]]&#39; = &lt;function structure2tensor_transform at 0x7f69602b55a0&gt;, ids: &#39;list[str] | None&#39; = None, fallback_to_holo: &#39;bool&#39; = True, use_canonical_apo: &#39;bool&#39; = True, crop_equal_monomer_shapes: &#39;bool&#39; = True, index_query: &#39;str | None&#39; = None, metadata_query: &#39;str | None&#39; = None, pre_specified_monomers: &#39;dict[str, str] | pd.DataFrame | None&#39; = None, **kwargs: &#39;Any&#39;) -&gt; &#39;None&#39;
 |  
 |  Method resolution order:
 |      PinderDataset
 |      torch.utils.data.dataset.Dataset
 |      typing.Generic
 |      builtins.object
 |  
 |  Methods defined here:
 |  
 |  __getitem__(self, idx: &#39;int&#39;) -&gt; &#39;dict[str, dict[str, torch.Tensor] | torch.Tensor]&#39;
 |  
 |  __init__(self, split: &#39;str | None&#39; = None, index: &#39;pd.DataFrame | None&#39; = None, metadata: &#39;pd.DataFrame | None&#39; = None, monomer_priority: &#39;str&#39; = &#39;holo&#39;, base_filters: &#39;list[PinderFilterBase]&#39; = [], sub_filters: &#39;list[PinderFilterSubBase]&#39; = [], structure_filters: &#39;list[StructureFilter]&#39; = [], structure_transforms_target: &#39;list[StructureTransform]&#39; = [], structure_transforms_feature: &#39;list[StructureTransform]&#39; = [], transform: &#39;Callable[[Structure], torch.Tensor | dict[str, torch.Tensor]]&#39; = &lt;function structure2tensor_transform at 0x7f69602b55a0&gt;, target_transform: &#39;Callable[[Structure], torch.Tensor | dict[str, torch.Tensor]]&#39; = &lt;function structure2tensor_transform at 0x7f69602b55a0&gt;, ids: &#39;list[str] | None&#39; = None, fallback_to_holo: &#39;bool&#39; = True, use_canonical_apo: &#39;bool&#39; = True, crop_equal_monomer_shapes: &#39;bool&#39; = True, index_query: &#39;str | None&#39; = None, metadata_query: &#39;str | None&#39; = None, pre_specified_monomers: &#39;dict[str, str] | pd.DataFrame | None&#39; = None, **kwargs: &#39;Any&#39;) -&gt; &#39;None&#39;
 |      Initialize self.  See help(type(self)) for accurate signature.
 |  
 |  __len__(self) -&gt; &#39;int&#39;
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes defined here:
 |  
 |  __annotations__ = {}
 |  
 |  __parameters__ = ()
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from torch.utils.data.dataset.Dataset:
 |  
 |  __add__(self, other: &#39;Dataset[T_co]&#39;) -&gt; &#39;ConcatDataset[T_co]&#39;
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from torch.utils.data.dataset.Dataset:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes inherited from torch.utils.data.dataset.Dataset:
 |  
 |  __orig_bases__ = (typing.Generic[+T_co],)
 |  
 |  ----------------------------------------------------------------------
 |  Class methods inherited from typing.Generic:
 |  
 |  __class_getitem__(params) from builtins.type
 |  
 |  __init_subclass__(*args, **kwargs) from builtins.type
 |      This method is called when a class is subclassed.
 |      
 |      The default implementation does nothing. It may be
 |      overridden to extend subclasses.
</pre></div>
</div>
</div>
</div>
</section>
<section id="torch-dataloader-for-pinderdataset">
<h3>Torch DataLoader for PinderDataset<a class="headerlink" href="#torch-dataloader-for-pinderdataset" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code> can be served by a <code class="docutils literal notranslate"><span class="pre">torch.utils.data.DataLoader</span></code>.</p>
<p>There is a convenience function <code class="docutils literal notranslate"><span class="pre">pinder.core.loader.dataset.get_torch_loader</span></code> for taking a <code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code> and returning a <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code> for the dataset object.</p>
<p>We can leverage the default <code class="docutils literal notranslate"><span class="pre">collate_fn</span></code> (<code class="docutils literal notranslate"><span class="pre">pinder.core.loader.dataset.collate_batch</span></code>) to merge multiple systems (<code class="docutils literal notranslate"><span class="pre">Dataset</span></code> items) to create mini-batches of tensors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader.dataset</span> <span class="kn">import</span> <span class="n">collate_batch</span><span class="p">,</span> <span class="n">get_torch_loader</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">get_torch_loader</span><span class="p">(</span>
    <span class="n">train_dataset</span><span class="p">,</span> 
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_batch</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">,</span> <span class="n">DataLoader</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">)</span>

<span class="c1"># Get a batch from the dataloader</span>
<span class="n">batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">))</span>

<span class="c1"># expected batch dict keys</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;target_complex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;feature_complex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sample_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;target_id&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;target_complex&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;target_complex&quot;</span><span class="p">][</span><span class="s2">&quot;atom_coordinates&quot;</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
<span class="n">feature_coords</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;feature_complex&quot;</span><span class="p">][</span><span class="s2">&quot;atom_coordinates&quot;</span><span class="p">]</span>
<span class="c1"># Ensure batch size propagates to tensor dims</span>
<span class="k">assert</span> <span class="n">feature_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">batch_size</span>
<span class="c1"># Ensure coordinates have dim 3</span>
<span class="k">assert</span> <span class="n">feature_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:41,136 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:41,860 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
</div>
</div>
</section>
<section id="torch-geometric-dataset">
<h3>Torch geometric Dataset<a class="headerlink" href="#torch-geometric-dataset" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure to install torch_cluster</span>
<span class="c1"># !pip install torch_cluster</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader.dataset</span> <span class="kn">import</span> <span class="n">PPIDataset</span>
<span class="kn">from</span> <span class="nn">pinder.core.loader.geodata</span> <span class="kn">import</span> <span class="n">NodeRepresentation</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="p">{</span><span class="n">NodeRepresentation</span><span class="p">(</span><span class="s2">&quot;atom&quot;</span><span class="p">),</span> <span class="n">NodeRepresentation</span><span class="p">(</span><span class="s2">&quot;residue&quot;</span><span class="p">)}</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">PPIDataset</span><span class="p">(</span>
    <span class="n">node_types</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="n">monomer1</span><span class="o">=</span><span class="s2">&quot;holo_receptor&quot;</span><span class="p">,</span>
    <span class="n">monomer2</span><span class="o">=</span><span class="s2">&quot;holo_ligand&quot;</span><span class="p">,</span>
    <span class="n">limit_by</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">force_reload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>

<span class="n">train_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing...
2024-11-15 12:13:49,610 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:50,822 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:51,243 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:52,054 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:52,436 | pinder.core.loader.dataset:550 | INFO : Finished processing, only 5 systems
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done!
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PPIDataset(5)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch_geometric.data</span> <span class="kn">import</span> <span class="n">HeteroData</span>
<span class="kn">from</span> <span class="nn">pinder.core</span> <span class="kn">import</span> <span class="n">get_index</span>

<span class="c1"># Here we check that we correctly capped the number of systems to load to 5 (via limit_by)</span>
<span class="n">pindex</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">()</span>
<span class="n">raw_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">raw_file_names</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_ids</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pindex</span><span class="o">.</span><span class="n">id</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">5</span>
<span class="n">processed_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">processed_file_names</span><span class="p">}</span>
<span class="c1"># Here we ensure that all 5 ids got processed and saved as .pt file on disk</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_ids</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pindex</span><span class="o">.</span><span class="n">id</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">5</span>

<span class="c1"># Let&#39;s get an item from the dataset by index </span>
<span class="n">data_item</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_item</span><span class="p">,</span> <span class="n">HeteroData</span><span class="p">)</span>
<span class="n">data_item</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PairedPDB(
  ligand_residue={
    residueid=[121, 1],
    pos=[121, 3],
    edge_index=[2, 1210],
    chain=[1],
  },
  receptor_residue={
    residueid=[144, 1],
    pos=[144, 3],
    edge_index=[2, 1440],
    chain=[1],
  },
  ligand_atom={
    x=[958, 1],
    pos=[958, 3],
    edge_index=[2, 9580],
  },
  receptor_atom={
    x=[1119, 1],
    pos=[1119, 3],
    edge_index=[2, 11190],
  },
  pdb={
    id=[1],
    num_nodes=1,
  }
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_item</span><span class="o">.</span><span class="n">num_node_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ligand_residue&#39;: 0,
 &#39;receptor_residue&#39;: 0,
 &#39;ligand_atom&#39;: 1,
 &#39;receptor_atom&#39;: 1,
 &#39;pdb&#39;: 0}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_item</span><span class="p">[</span><span class="s2">&quot;ligand_atom&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;x&#39;: tensor([[ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [10.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [22.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 7.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [11.],
        [30.],
        [ 5.],
        [14.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [11.],
        [30.],
        [ 5.],
        [14.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 7.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [10.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 6.],
        [31.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [22.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [33.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [11.],
        [30.],
        [ 5.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 6.],
        [31.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [26.],
        [25.],
        [11.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 7.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [34.],
        [30.],
        [ 4.],
        [13.],
        [16.],
        [18.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 6.],
        [31.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 7.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 7.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [22.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [11.],
        [30.],
        [ 5.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [33.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [26.],
        [25.],
        [11.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [11.],
        [30.],
        [ 5.],
        [14.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [17.],
        [ 5.],
        [ 9.],
        [20.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [10.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [27.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [31.],
        [28.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [35.],
        [23.],
        [ 7.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [21.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [29.],
        [12.],
        [24.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [10.],
        [23.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [19.],
        [32.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.],
        [ 8.],
        [15.],
        [ 7.],
        [25.],
        [11.],
        [30.],
        [ 5.],
        [ 0.],
        [ 1.],
        [ 2.],
        [ 3.]]), &#39;pos&#39;: tensor([[207.6910, 164.0670, 172.7860],
        [208.6350, 163.8290, 173.9130],
        [209.3790, 165.0800, 174.3180],
        ...,
        [240.2730, 173.0310, 178.0680],
        [240.1680, 174.1280, 177.0260],
        [240.3170, 173.8780, 175.8300]]), &#39;edge_index&#39;: tensor([[  1,   2,   4,  ..., 946, 894, 893],
        [  0,   0,   0,  ..., 957, 957, 957]])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can also get an item by its system ID </span>
<span class="n">data_item</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="s2">&quot;8phr__X4_UNDEFINED--8phr__W4_UNDEFINED&quot;</span><span class="p">)</span>
<span class="n">data_item</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PairedPDB(
  ligand_residue={
    residueid=[158, 1],
    pos=[158, 3],
    edge_index=[2, 1580],
    chain=[1],
  },
  receptor_residue={
    residueid=[171, 1],
    pos=[171, 3],
    edge_index=[2, 1710],
    chain=[1],
  },
  ligand_atom={
    x=[1198, 1],
    pos=[1198, 3],
    edge_index=[2, 11980],
  },
  receptor_atom={
    x=[1358, 1],
    pos=[1358, 3],
    edge_index=[2, 13580],
  },
  pdb={
    id=[1],
    num_nodes=1,
  }
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PPIDataset (#graphs=5):
+------------+----------+----------+
|            |   #nodes |   #edges |
|------------+----------+----------|
| mean       |   2612.4 |        0 |
| std        |   1631.6 |        0 |
| min        |    999   |        0 |
| quantile25 |   1600   |        0 |
| median     |   2343   |        0 |
| quantile75 |   2886   |        0 |
| max        |   5234   |        0 |
+------------+----------+----------+
Number of nodes per node type:
+------------+------------------+--------------------+---------------+-----------------+-------+
|            |   ligand_residue |   receptor_residue |   ligand_atom |   receptor_atom |   pdb |
|------------+------------------+--------------------+---------------+-----------------+-------|
| mean       |            140.2 |              152.8 |        1103.4 |          1215   |     1 |
| std        |             90.2 |               87.5 |         738.9 |           717.1 |     0 |
| min        |             58   |               62   |         426   |           452   |     1 |
| quantile25 |             78   |               97   |         622   |           802   |     1 |
| median     |            121   |              144   |         958   |          1119   |     1 |
| quantile75 |            158   |              171   |        1198   |          1358   |     1 |
| max        |            286   |              290   |        2313   |          2344   |     1 |
+------------+------------------+--------------------+---------------+-----------------+-------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="pairedpdb-torch-geometric-heterodata-object">
<h3>PairedPDB torch-geometric HeteroData object<a class="headerlink" href="#pairedpdb-torch-geometric-heterodata-object" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">PPIDataset</span></code> represents its data items as <code class="docutils literal notranslate"><span class="pre">PairedPDB</span></code> objects, where the receptor and ligand are encoded separately in a heterogeneous graph, via <code class="docutils literal notranslate"><span class="pre">torch_geometric.data.HeteroData</span></code>, holding multiple node and/or edge types in disjunct storage objects.</p>
<p>It leverages the <code class="docutils literal notranslate"><span class="pre">PinderLoader</span></code> to apply optional filters and/or transforms and implements a caching system by saving processed systems to disk in <code class="docutils literal notranslate"><span class="pre">.pt</span></code> files.
The <code class="docutils literal notranslate"><span class="pre">PairedPDB</span></code> implements a conversion method <code class="docutils literal notranslate"><span class="pre">.from_pinder_system</span></code> that takes in a <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code> and converts it to a <code class="docutils literal notranslate"><span class="pre">PairedPDB</span></code> object.</p>
<p>For more details on the torch-geometric Dataset APIs, please refer to the <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/tutorial/create_dataset.html">tutorials</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader.geodata</span> <span class="kn">import</span> <span class="n">PairedPDB</span>
<span class="kn">from</span> <span class="nn">torch_geometric.data</span> <span class="kn">import</span> <span class="n">HeteroData</span>

<span class="n">pinder_id</span> <span class="o">=</span> <span class="s2">&quot;3s9d__B1_P48551--3s9d__A1_P01563&quot;</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">PinderSystem</span><span class="p">(</span><span class="n">pinder_id</span><span class="p">)</span>

<span class="n">holo_data</span> <span class="o">=</span> <span class="n">PairedPDB</span><span class="o">.</span><span class="n">from_pinder_system</span><span class="p">(</span>
    <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
    <span class="n">monomer1</span><span class="o">=</span><span class="s2">&quot;holo_receptor&quot;</span><span class="p">,</span> <span class="n">monomer2</span><span class="o">=</span><span class="s2">&quot;holo_ligand&quot;</span><span class="p">,</span>
    <span class="n">node_types</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">holo_data</span><span class="p">,</span> <span class="n">HeteroData</span><span class="p">)</span>
<span class="n">expected_node_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ligand_residue&#39;</span><span class="p">,</span> <span class="s1">&#39;receptor_residue&#39;</span><span class="p">,</span> <span class="s1">&#39;ligand_atom&#39;</span><span class="p">,</span> <span class="s1">&#39;receptor_atom&#39;</span>
<span class="p">]</span>
<span class="k">assert</span> <span class="n">holo_data</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">==</span> <span class="mi">2780</span>
<span class="k">assert</span> <span class="n">holo_data</span><span class="o">.</span><span class="n">num_edges</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">holo_data</span><span class="o">.</span><span class="n">num_node_features</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
<span class="n">expected_num_feats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ligand_residue&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;receptor_residue&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;ligand_atom&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;receptor_atom&#39;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expected_num_feats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">holo_data</span><span class="o">.</span><span class="n">num_node_features</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span>

<span class="k">assert</span> <span class="n">holo_data</span><span class="o">.</span><span class="n">node_types</span> <span class="o">==</span> <span class="n">expected_node_types</span>


<span class="n">holo_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:53,464 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=15
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PairedPDB(
  ligand_residue={
    residueid=[127, 1],
    pos=[127, 3],
    edge_index=[2, 1270],
    chain=[1],
  },
  receptor_residue={
    residueid=[180, 1],
    pos=[180, 3],
    edge_index=[2, 1800],
    chain=[1],
  },
  ligand_atom={
    x=[1032, 1],
    pos=[1032, 3],
    edge_index=[2, 10320],
  },
  receptor_atom={
    x=[1441, 1],
    pos=[1441, 3],
    edge_index=[2, 14410],
  }
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># You can target specific monomers (apo/holo/pred) for the receptor and ligand</span>
<span class="n">apo_data</span> <span class="o">=</span> <span class="n">PairedPDB</span><span class="o">.</span><span class="n">from_pinder_system</span><span class="p">(</span>
    <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
    <span class="n">monomer1</span><span class="o">=</span><span class="s2">&quot;apo_receptor&quot;</span><span class="p">,</span> <span class="n">monomer2</span><span class="o">=</span><span class="s2">&quot;apo_ligand&quot;</span><span class="p">,</span>
    <span class="n">node_types</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">apo_data</span><span class="p">,</span> <span class="n">HeteroData</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">apo_data</span><span class="o">.</span><span class="n">num_nodes</span> <span class="o">==</span> <span class="mi">3437</span>
<span class="k">assert</span> <span class="n">apo_data</span><span class="o">.</span><span class="n">num_edges</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">apo_data</span><span class="o">.</span><span class="n">num_node_features</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
<span class="n">expected_num_feats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ligand_residue&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;receptor_residue&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;ligand_atom&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;receptor_atom&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expected_num_feats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">apo_data</span><span class="o">.</span><span class="n">num_node_features</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span>

<span class="k">assert</span> <span class="n">apo_data</span><span class="o">.</span><span class="n">node_types</span> <span class="o">==</span> <span class="n">expected_node_types</span>

<span class="n">apo_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PairedPDB(
  ligand_residue={
    residueid=[165, 1],
    pos=[165, 3],
    edge_index=[2, 1650],
    chain=[1],
  },
  receptor_residue={
    residueid=[212, 1],
    pos=[212, 3],
    edge_index=[2, 2120],
    chain=[1],
  },
  ligand_atom={
    x=[1350, 1],
    pos=[1350, 3],
    edge_index=[2, 13500],
  },
  receptor_atom={
    x=[1710, 1],
    pos=[1710, 3],
    edge_index=[2, 17100],
  }
)
</pre></div>
</div>
</div>
</div>
</section>
<section id="torch-geometric-dataloader">
<h3>Torch geometric DataLoader<a class="headerlink" href="#torch-geometric-dataloader" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">PPIDataset</span></code> can be served by a <code class="docutils literal notranslate"><span class="pre">torch_geometric.DataLoader</span></code>.</p>
<p>There is a convenience function <code class="docutils literal notranslate"><span class="pre">pinder.core.loader.dataset.get_geo_loader</span></code> for taking a PPIDataset and returning a <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code> for the dataset object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader.dataset</span> <span class="kn">import</span> <span class="n">get_geo_loader</span>
<span class="kn">from</span> <span class="nn">torch_geometric.loader</span> <span class="kn">import</span> <span class="n">DataLoader</span>


<span class="n">loader</span> <span class="o">=</span> <span class="n">get_geo_loader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">DataLoader</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">dataset</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>


<span class="n">loader</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;torch_geometric.loader.dataloader.DataLoader at 0x7f697dbfdb40&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PPIDataset(5)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="implementing-your-own-pytorch-dataset-dataloader-for-pinder">
<h2>Implementing your own PyTorch Dataset &amp; DataLoader for pinder<a class="headerlink" href="#implementing-your-own-pytorch-dataset-dataloader-for-pinder" title="Link to this heading">#</a></h2>
<p>While the previous sections covered two example implementations of leveraging the torch and torch-geometric APIs, below we will illustrate how you can write your own PyTorch data pipeline to feed your model.</p>
<p>We will focus on writing a minimalistic example that simply fetches PDB files and returns the coordinates as tensors. We will also include an example of a sampler function for the dataloader to implement diversity sampling in your workflow.</p>
<section id="defining-the-dataset">
<h3>Defining the Dataset<a class="headerlink" href="#defining-the-dataset" title="Link to this heading">#</a></h3>
<p>Below we will write a barebones <code class="docutils literal notranslate"><span class="pre">torch.utils.data.Dataset</span></code> object that implements at a minimum:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code> method</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__len__</span></code> method returning the number of items in the dataset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method that returns an item in the dataset</p></li>
</ul>
<p>We will also add an option to include apo and predicted monomer types by adding a <code class="docutils literal notranslate"><span class="pre">monomer_priority</span></code> argument to our dataset. The argument will be set to “random” by default, indicating that we want to randomly sample a monomer type from the set of monomers available for a given system. We could also target a specific monomer type by setting this argument to one of “holo”, “apo”, “predicted”. Not every system in the training set has apo or predicted structures available, so we will also add a <code class="docutils literal notranslate"><span class="pre">fallback_to_holo</span></code> argument to indicate whether we want to use <code class="docutils literal notranslate"><span class="pre">holo</span></code> monomers when the selected monomer type is not available.</p>
<p>We also define two interfaces for applying filters to our dataset:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metadata_filter</span></code>: a query string to apply to the pinder metadata pandas DataFrame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system_filters:</span> <span class="pre">list[PinderFilterBase]</span></code>: a list of filters that inheret a base class, <code class="docutils literal notranslate"><span class="pre">PinderFilterBase</span></code>, which serves as the abstraction layer for defining <code class="docutils literal notranslate"><span class="pre">PinderSystem</span></code>-based filters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">structure_filters:</span> <span class="pre">list[StructureFilter]</span></code>: a list of filters that inheret a base class, <code class="docutils literal notranslate"><span class="pre">StructureFilter</span></code>, which serves as the abstraction layer for defining <code class="docutils literal notranslate"><span class="pre">Structure</span></code>-based filters</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">NDArray</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">pinder.core</span> <span class="kn">import</span> <span class="n">get_index</span><span class="p">,</span> <span class="n">get_metadata</span>
<span class="kn">from</span> <span class="nn">pinder.core.loader.loader</span> <span class="kn">import</span> <span class="n">_create_target_feature_complex</span><span class="p">,</span> <span class="n">select_monomer</span>
<span class="kn">from</span> <span class="nn">pinder.core.loader.structure</span> <span class="kn">import</span> <span class="n">Structure</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">get_metadata</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CustomPinderDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
        <span class="n">monomer_priority</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> 
        <span class="n">fallback_to_holo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
        <span class="n">crop_equal_monomer_shapes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_canonical_apo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">target_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">structure_filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">filters</span><span class="o">.</span><span class="n">StructureFilter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">system_filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">filters</span><span class="o">.</span><span class="n">PinderFilterBase</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">metadata_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_load_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Which split/mode we are using for the dataset instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="n">split</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monomer_priority</span> <span class="o">=</span> <span class="n">monomer_priority</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fallback_to_holo</span> <span class="o">=</span> <span class="n">fallback_to_holo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_equal_monomer_shapes</span> <span class="o">=</span> <span class="n">crop_equal_monomer_shapes</span>

        <span class="c1"># Optional transform and target transform to apply (will be covered shortly)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_transform</span> <span class="o">=</span> <span class="n">target_transform</span>
        <span class="c1"># Optional system-level filters to apply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_filters</span> <span class="o">=</span> <span class="n">system_filters</span>
        <span class="c1"># Optional structure filters to apply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_filters</span> <span class="o">=</span> <span class="n">structure_filters</span>

        <span class="c1"># Maximum number of times to try sampling another index from the dataset until an exception is raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_load_attempts</span> <span class="o">=</span> <span class="n">max_load_attempts</span>
        <span class="c1"># Whether we should use canonical apo structures (apo_R/L_pdb columns in pinder index) if apo monomers are selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_canonical_apo</span> <span class="o">=</span> <span class="n">use_canonical_apo</span>
        
        <span class="c1"># Define the subset of the pinder index and metadata corresponding to the split of our dataset instance </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;split == &quot;</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">id</span><span class="p">))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata_filter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">metadata_filter</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to apply metadata_filter=</span><span class="si">{</span><span class="n">metadata_filter</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">id</span><span class="p">))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">]]:</span>
        <span class="n">valid_idx</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">valid_idx</span> <span class="ow">and</span> <span class="n">attempts</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_load_attempts</span><span class="p">:</span>
            <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">PinderSystem</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_system_filters</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">PinderSystem</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">selected_monomers</span> <span class="o">=</span> <span class="n">select_monomer</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monomer_priority</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fallback_to_holo</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">use_canonical_apo</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># With the system and selected_monomers objects, we can now create a pair of dimer complexes</span>
            <span class="c1"># Below we leverage the existing utility from the PinderLoader (_create_target_feature_complex)</span>
            <span class="n">target_complex</span><span class="p">,</span> <span class="n">feature_complex</span> <span class="o">=</span> <span class="n">_create_target_feature_complex</span><span class="p">(</span>
                <span class="n">system</span><span class="p">,</span> <span class="n">selected_monomers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_equal_monomer_shapes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_to_holo</span>
            <span class="p">)</span>
            <span class="n">valid_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_structure_filters</span><span class="p">(</span><span class="n">target_complex</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_idx</span><span class="p">:</span>
                <span class="c1"># Try another index before raising IndexError</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_idx</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to find a valid item in the dataset satisfying filters at </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">attempts</span><span class="si">}</span><span class="s2"> attempts!&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feature_complex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">feature_complex</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target_complex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_transform</span><span class="p">(</span><span class="n">target_complex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_complex</span><span class="p">,</span> <span class="n">target_complex</span>

    <span class="k">def</span> <span class="nf">apply_structure_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">pass_filters</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">structure_filter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_filters</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">structure_filter</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
                <span class="n">pass_filters</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">pass_filters</span>

    <span class="k">def</span> <span class="nf">apply_system_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="n">PinderSystem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PinderSystem</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">system_filter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_filters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_filter</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">PinderFilterBase</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">base_filter</span><span class="p">(</span><span class="n">system</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">system</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;CustomPinderDataset(split=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="si">}</span><span class="s2">, monomers=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">monomer_priority</span><span class="si">}</span><span class="s2">, systems=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note the selected monomers indicated by Structure.pinder_id attributes. Since we enabled cropping, the feature and target complex AtomArray have identical shapes </span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">CustomPinderDataset</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Structure(
     filepath=/home/runner/.local/share/pinder/2024-02/test_set_pdbs/7rzb__A1_A0A229LVN5-R--7rzb__A2_A0A229LVN5-L.pdb,
     uniprot_map=&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; with shape (294, 14),
     pinder_id=&#39;7rzb__A1_A0A229LVN5-R--7rzb__A2_A0A229LVN5-L&#39;,
     atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (2092,),
     pdb_engine=&#39;fastpdb&#39;,
 ),
 Structure(
     filepath=/home/runner/.local/share/pinder/2024-02/test_set_pdbs/7rzb__A1_A0A229LVN5-R--7rzb__A2_A0A229LVN5-L.pdb,
     uniprot_map=&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; with shape (294, 14),
     pinder_id=&#39;7rzb__A1_A0A229LVN5-R--7rzb__A2_A0A229LVN5-L&#39;,
     atom_array=&lt;class &#39;biotite.structure.AtomArray&#39;&gt; with shape (2092,),
     pdb_engine=&#39;fastpdb&#39;,
 ))
</pre></div>
</div>
</div>
</div>
<p>In the above example, we wrote a torch Dataset that currently returns a tuple of <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects (one representing the “decoy” or sample to use for features and the other representing the ground-truth “label”)</p>
<p>Of course we wouldn’t use these <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects directly in our model. In your model, you will have to choose which features to compute and which data structure to use to represent them.</p>
<p>While the <code class="docutils literal notranslate"><span class="pre">PinderDataset</span></code> and <code class="docutils literal notranslate"><span class="pre">PPIDataset</span></code> datasets provide examples of feature encodings, below we will adjust the <code class="docutils literal notranslate"><span class="pre">transform</span></code> and <code class="docutils literal notranslate"><span class="pre">target_transform</span></code> objects to simply return NumPy NDArray objects as a default. Note: you can’t pass <code class="docutils literal notranslate"><span class="pre">Structure</span></code> objects to torch DataLoader, you must first convert them into array-like structures supported by the default torch collate_fn. You can implement your own collate functions to adjust this behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">default_transform</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">structure</span><span class="o">.</span><span class="n">coords</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">CustomPinderDataset</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">default_transform</span><span class="p">,</span> <span class="n">target_transform</span><span class="o">=</span><span class="n">default_transform</span><span class="p">)</span>
<span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[-19.331, -10.568,  -4.591],
        [-18.082, -10.305,  -3.883],
        [-16.867, -10.692,  -4.727],
        ...,
        [ 13.363,  11.96 ,  -6.092],
        [ 15.081,   9.028,  -5.759],
        [ 12.459,  10.17 ,  -6.767]], dtype=float32),
 array([[-13.215324 , -11.076902 ,  15.214827 ],
        [-14.133494 , -10.301851 ,  14.38616  ],
        [-13.614427 ,  -8.882866 ,  14.150835 ],
        ...,
        [  6.8049655, -15.96424  ,  20.159506 ],
        [  9.54528  , -16.992254 ,  18.400843 ],
        [  7.021378 , -15.329907 ,  18.152586 ]], dtype=float32))
</pre></div>
</div>
</div>
</div>
</section>
<section id="implementing-diversity-sampling">
<h3>Implementing diversity sampling<a class="headerlink" href="#implementing-diversity-sampling" title="Link to this heading">#</a></h3>
<p>Here, we provide an example of how one might use <code class="docutils literal notranslate"><span class="pre">torch.utils.data.WeightedRandomSampler</span></code>. However, users are free to sample diversity any way they see fit. For this example, we are going to sample diversity inversely proportional to pinder cluster population size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">WeightedRandomSampler</span>

<span class="k">def</span> <span class="nf">inverse_cluster_size_sampler</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">PinderDataset</span><span class="p">,</span> <span class="n">replacement</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">index</span>
    <span class="n">cluster_counts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">index</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;cluster_count&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">cluster_counts</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="c1"># undersample large clusters</span>
    <span class="n">cluster_weights</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">cluster_count</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">WeightedRandomSampler</span><span class="p">(</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">cluster_weights</span><span class="p">,</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
            <span class="n">cluster_counts</span>
        <span class="p">),</span>
        <span class="n">replacement</span><span class="o">=</span><span class="n">replacement</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">sampler</span> <span class="o">=</span> <span class="n">inverse_cluster_size_sampler</span><span class="p">(</span>
    <span class="n">test_data</span><span class="p">,</span>
    <span class="n">replacement</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sampler</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;torch.utils.data.sampler.WeightedRandomSampler at 0x7f697dc7e200&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-the-dataloader">
<h3>Defining the dataloader<a class="headerlink" href="#defining-the-dataloader" title="Link to this heading">#</a></h3>
<p>Now that we have implemented a dataset and sampling function, we can tie everything together to implement the <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="n">test_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">test_data</span><span class="p">,</span> 
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
    <span class="c1"># Mutually exclusive with sampler</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">test_dataloader</span><span class="p">))</span>
<span class="n">test_features</span><span class="p">,</span> <span class="n">test_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:13:55,075 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(tensor([[[ -0.7287,  16.4913,   9.8068],
          [ -1.6878,  16.1829,  10.8788],
          [ -2.9926,  16.9600,  10.6499],
          ...,
          [ -3.8695, -10.1312,  23.1116],
          [ -1.7981,  -9.4029,  23.5338],
          [ -2.8393,  -9.4165,  22.7493]]]),
 tensor([[[-0.9892, 19.1343,  8.9643],
          [-1.5965, 18.3829, 10.0574],
          [-3.1128, 18.5439, 10.0904],
          ...,
          [-7.1361, -8.3044, 11.7833],
          [-8.0210, -9.1269, 12.3305],
          [-7.5183, -7.4610, 10.8316]]]))
</pre></div>
</div>
</div>
</div>
<p>Putting it all together, we can now get a train/val/test dataloader as such:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>


<span class="k">def</span> <span class="nf">get_loader</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">CustomPinderDataset</span><span class="p">,</span>
    <span class="n">sampler</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Sampler</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inverse_cluster_size_sampler</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="c1"># shuffle is mutually exclusive with sampler</span>
    <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">collate_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">]]]],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DataLoader[CustomPinderDataset]&quot;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
        <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_fn</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">train_data</span> <span class="o">=</span> <span class="n">CustomPinderDataset</span><span class="p">(</span>
    <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> 
    <span class="n">structure_filters</span><span class="o">=</span><span class="p">[</span><span class="n">filters</span><span class="o">.</span><span class="n">MinAtomTypesFilter</span><span class="p">()],</span> 
    <span class="n">metadata_filter</span><span class="o">=</span><span class="s2">&quot;(buried_sasa &gt;= 500)&quot;</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">default_transform</span><span class="p">,</span> 
    <span class="n">target_transform</span><span class="o">=</span><span class="n">default_transform</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">get_loader</span><span class="p">(</span>
    <span class="n">train_data</span><span class="p">,</span> 
    <span class="n">sampler</span><span class="o">=</span><span class="n">inverse_cluster_size_sampler</span><span class="p">(</span><span class="n">train_data</span><span class="p">),</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">train_dataloader</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;torch.utils.data.dataloader.DataLoader at 0x7f69817f7e80&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">))</span>
<span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:14:00,725 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(tensor([[[161.0880, 121.9010, 154.0680],
          [159.7830, 122.5170, 153.9220],
          [159.8500, 124.0310, 153.9140],
          ...,
          [142.9230, 142.9120,  73.1190],
          [142.6480, 142.3420,  74.4990],
          [142.6460, 140.8530,  74.4910]]]),
 tensor([[[161.0880, 121.9010, 154.0680],
          [159.7830, 122.5170, 153.9220],
          [159.8500, 124.0310, 153.9140],
          ...,
          [142.9230, 142.9120,  73.1190],
          [142.6480, 142.3420,  74.4990],
          [142.6460, 140.8530,  74.4910]]]))
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-a-larger-batch-size-collate-fn">
<h3>Using a larger batch size (collate_fn)<a class="headerlink" href="#using-a-larger-batch-size-collate-fn" title="Link to this heading">#</a></h3>
<p>What if we want to use a larger batch size?</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">collate_fn</span></code> used by the DataLoader is <code class="docutils literal notranslate"><span class="pre">torch.utils.data._utils.collate.default_collate</span></code> which expects to be able to stack tensors via <code class="docutils literal notranslate"><span class="pre">torch.stack</span></code>.</p>
<p>Since different pinder systems have a differing number of atomic coordinates, using a batch size greater than 1 will cause this function to raise a RuntimeError with a message like:
<code class="docutils literal notranslate"><span class="pre">RuntimeError:</span> <span class="pre">stack</span> <span class="pre">expects</span> <span class="pre">each</span> <span class="pre">tensor</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">equal</span> <span class="pre">size,</span> <span class="pre">but</span> <span class="pre">got</span> <span class="pre">[688,</span> <span class="pre">3]</span> <span class="pre">at</span> <span class="pre">entry</span> <span class="pre">0</span> <span class="pre">and</span> <span class="pre">[1391,</span> <span class="pre">3]</span> <span class="pre">at</span> <span class="pre">entry</span> <span class="pre">1</span></code></p>
<p>We can leverage existing pinder utilities to adapt our default collate_fn to pad tensor dimensions with dummy values so that they can be stacked.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pinder.core.loader.dataset</span> <span class="kn">import</span> <span class="n">pad_and_stack</span>

<span class="n">help</span><span class="p">(</span><span class="n">pad_and_stack</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function pad_and_stack in module pinder.core.loader.dataset:

pad_and_stack(tensors: &#39;list[Tensor]&#39;, dim: &#39;int&#39; = 0, dims_to_pad: &#39;list[int] | None&#39; = None, value: &#39;int | float | None&#39; = None) -&gt; &#39;Tensor&#39;
    Pads a list of tensors to the maximum length observed along each dimension and then stacks them along a new dimension (given by `dim`).
    
    Parameters:
        tensors (list[Tensor]): A list of tensors to pad and stack
        dim (int): The new dimension to stack along.
        dims_to_pad (list[int] | None): The dimensions to pad
        value (int | float | None, optional): The value to pad with, by default None
    
    Returns:
        Tensor: The padded and stacked tensor. Below are examples of input and output shapes
            Example 1: Sequence features (although redundant with torch.rnn.utils.pad_sequence)
                input: [(2,), (7,)], dim: 0
                output: (2, 7)
            Example 2: Pair features (e.g., pairwise coordinates)
                input: [(4, 4, 3), (7, 7, 3)], dim: 0
                output: (2, 7, 7, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">collate_coordinates</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">coords_pad_value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">feature_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
        <span class="n">feat</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">feature_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
        <span class="n">target_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="n">feature_coords</span> <span class="o">=</span> <span class="n">pad_and_stack</span><span class="p">(</span><span class="n">feature_coords</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">coords_pad_value</span><span class="p">)</span>    
    <span class="n">target_coords</span> <span class="o">=</span> <span class="n">pad_and_stack</span><span class="p">(</span><span class="n">target_coords</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">coords_pad_value</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">feature_coords</span><span class="p">,</span> <span class="n">target_coords</span>


<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">get_loader</span><span class="p">(</span>
    <span class="n">train_data</span><span class="p">,</span> 
    <span class="n">sampler</span><span class="o">=</span><span class="n">inverse_cluster_size_sampler</span><span class="p">(</span><span class="n">train_data</span><span class="p">),</span>
    <span class="n">collate_fn</span><span class="o">=</span><span class="n">collate_coordinates</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">))</span>
<span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:14:01,733 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-11-15 12:14:13,286 | pinder.core.utils.cloud:375 | INFO : Gsutil process_many=download_to_filename, threads=4, items=7
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(tensor([[[ 246.8259,  207.0484,  365.5238],
          [ 246.7659,  208.4906,  365.3517],
          [ 247.3034,  208.7366,  363.9514],
          ...,
          [ 197.3790,  222.5565,  382.4614],
          [ 196.3958,  221.6868,  381.6732],
          [ 196.9519,  221.3230,  380.3475]],
 
         [[ 367.6263,  324.4850,  301.8851],
          [ 367.0830,  325.2843,  302.9723],
          [ 367.2429,  326.7630,  302.6137],
          ...,
          [-100.0000, -100.0000, -100.0000],
          [-100.0000, -100.0000, -100.0000],
          [-100.0000, -100.0000, -100.0000]]]),
 tensor([[[ 251.3640,  191.2350,  360.7730],
          [ 251.2140,  190.5020,  359.5220],
          [ 251.7570,  191.3220,  358.3540],
          ...,
          [ 203.7410,  227.2750,  385.3440],
          [ 204.1620,  227.1150,  383.8930],
          [ 204.7830,  225.7870,  383.6390]],
 
         [[ 367.8460,  324.9710,  300.2600],
          [ 367.1610,  325.4500,  301.4540],
          [ 367.0780,  326.9710,  301.4500],
          ...,
          [-100.0000, -100.0000, -100.0000],
          [-100.0000, -100.0000, -100.0000],
          [-100.0000, -100.0000, -100.0000]]]))
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-and-loading-data-for-training">Accessing and loading data for training</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-pindersystem-and-structure-classes">Recap: PinderSystem and Structure classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-pinderloader-to-load-filter-and-transform-systems">Using the PinderLoader to load, filter and transform systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-a-specific-split">Loading a specific split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-a-specific-list-of-systems">Loading a specific list of systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-pinder-writer">Optional Pinder writer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-torch-datasets-and-dataloaders-from-pinder-systems">Constructing torch datasets and dataloaders from pinder systems</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pinderdataset-torch-dataset">PinderDataset (torch Dataset)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-alternative-monomers">Sampling alternative monomers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch-dataloader-for-pinderdataset">Torch DataLoader for PinderDataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch-geometric-dataset">Torch geometric Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pairedpdb-torch-geometric-heterodata-object">PairedPDB torch-geometric HeteroData object</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#torch-geometric-dataloader">Torch geometric DataLoader</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-your-own-pytorch-dataset-dataloader-for-pinder">Implementing your own PyTorch Dataset &amp; DataLoader for pinder</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-dataset">Defining the Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-diversity-sampling">Implementing diversity sampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-dataloader">Defining the dataloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-larger-batch-size-collate-fn">Using a larger batch size (collate_fn)</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/pinder-org/pinder/edit/main/doc/pinder-loader.ipynb">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/pinder-loader.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, PINDER Development Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>